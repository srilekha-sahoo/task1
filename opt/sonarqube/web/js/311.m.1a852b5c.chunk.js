(window.webpackJsonp=window.webpackJsonp||[]).push([[311],{1791:function(e,t,n){"use strict";n.r(t),n.d(t,"Notifications",(function(){return K}));var o=n(544),i=n.n(o),c=n(366),a=n(393),r=n(946),s=n(379),l=n(376),h=n(6),d=n(0),u=n(766),p=n(382),m=n(403),b=n(385);class f extends c.PureComponent{constructor(){super(...arguments),this.handleCheckOptOut=e=>{this.props.setCurrentUserSetting({key:"notifications.optOut",value:e?"false":"true"})}}render(){return c.createElement("section",{className:"boxed-group"},c.createElement("h2",null,Object(h.k)("my_profile.sonarcloud_feature_notifications.title")),c.createElement("div",{className:"boxed-group-inner"},c.createElement("table",{className:"data zebra"},c.createElement("thead",null,c.createElement("tr",null,c.createElement("th",null),c.createElement("th",{className:"text-center"},c.createElement("h4",null,Object(h.k)("activate"))))),c.createElement("tbody",null,c.createElement("tr",null,c.createElement("td",null,Object(h.k)("my_profile.sonarcloud_feature_notifications.description")),c.createElement("td",{className:"text-center"},c.createElement(m.a,{checked:!this.props.notificationsOptOut,onCheck:this.handleCheckOptOut})))))))}}const g={setCurrentUserSetting:n(632).e};var j=Object(p.b)(e=>({notificationsOptOut:"true"===Object(b.getCurrentUserSetting)(e,"notifications.optOut")}),g)(f);function k(e){return c.createElement(c.Fragment,null,c.createElement("section",{className:"boxed-group"},c.createElement("h2",null,Object(h.k)("my_profile.overall_notifications.title")),c.createElement("div",{className:"boxed-group-inner"},c.createElement("table",{className:"data zebra"},c.createElement("thead",null,c.createElement("tr",null,c.createElement("th",null),e.channels.map(e=>c.createElement("th",{className:"text-center",key:e},c.createElement("h4",null,Object(h.k)("notification.channel",e)))))),c.createElement(u.a,{channels:e.channels,checkboxId:v,notifications:e.notifications,onAdd:e.addNotification,onRemove:e.removeNotification,types:e.types})))),Object(d.isSonarCloud)()&&c.createElement(j,null))}function v(e,t){return"global-notification-".concat(e,"-").concat(t)}var E=n(555),y=n.n(E),x=n(387),O=n.n(x),N=n(445),S=n.n(N),C=n(368),w=n(414),P=n(422),_=n.n(P),D=n(367),M=n(425),T=n(383),I=n(391);class L extends c.PureComponent{constructor(e){super(e),this.mounted=!1,this.handleKeyDown=e=>{switch(e.keyCode){case 13:e.preventDefault(),this.handleSelectHighlighted();break;case 38:e.preventDefault(),this.handleHighlightPrevious();break;case 40:e.preventDefault(),this.handleHighlightNext()}},this.getCurrentIndex=()=>{const{highlighted:e,suggestions:t}=this.state;return e&&t?t.findIndex(t=>t.project===e.project):-1},this.highlightIndex=e=>{const{suggestions:t}=this.state;t&&t.length>0&&(e<0?e=t.length-1:e>=t.length&&(e=0),this.setState({highlighted:t[e]}))},this.handleHighlightPrevious=()=>{this.highlightIndex(this.getCurrentIndex()-1)},this.handleHighlightNext=()=>{this.highlightIndex(this.getCurrentIndex()+1)},this.handleSelectHighlighted=()=>{const{highlighted:e,selectedProject:t}=this.state;void 0!==e&&(void 0!==t&&e.project===t.project?this.handleSubmit():this.handleSelect(e))},this.handleSearch=e=>{const{addedProjects:t}=this.props;return e.length<2?(this.setState({open:!1,query:e}),Promise.resolve([])):(this.setState({loading:!0,query:e}),Object(M.v)(e).then(e=>{if(this.mounted){let n=void 0;const o=e.results.find(e=>"TRK"===e.q);o&&o.items.length>0&&(n=o.items.filter(e=>!t.find(t=>t.project===e.key)).map(e=>({project:e.key,projectName:e.name}))),this.setState({loading:!1,open:!0,suggestions:n})}},()=>{this.mounted&&this.setState({loading:!1,open:!1})}))},this.handleSelect=e=>{this.setState({open:!1,query:e.projectName,selectedProject:e})},this.handleSubmit=()=>{const{selectedProject:e}=this.state;e&&this.props.onSubmit(e)},this.state={},this.handleSearch=_()(this.handleSearch,250)}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const{closeModal:e}=this.props,{highlighted:t,loading:n,query:o,open:i,selectedProject:a,suggestions:r}=this.state,s=Object(h.k)("my_account.set_notifications_for.title");return c.createElement(I.a,{header:s,onClose:e,onSubmit:this.handleSubmit},({onCloseClick:e,onFormSubmit:l})=>c.createElement("form",{onSubmit:l},c.createElement("header",{className:"modal-head"},c.createElement("h2",null,s)),c.createElement("div",{className:"modal-body"},c.createElement("div",{className:"modal-field abs-width-400"},c.createElement("label",null,Object(h.k)("my_account.set_notifications_for")),c.createElement(w.a,{autoFocus:!0,onChange:this.handleSearch,onKeyDown:this.handleKeyDown,placeholder:Object(h.k)("search.placeholder"),value:o}),n&&c.createElement("i",{className:"spinner spacer-left"}),!n&&i&&c.createElement("div",{className:"position-relative"},c.createElement(T.a,{className:"abs-width-400",noPadding:!0},r&&r.length>0?c.createElement("ul",{className:"notifications-add-project-search-results"},r.map(e=>c.createElement("li",{className:D({active:t&&t.project===e.project}),key:e.project,onClick:()=>this.handleSelect(e)},e.projectName))):c.createElement("div",{className:"notifications-add-project-no-search-results"},Object(h.k)("no_results")))))),c.createElement("footer",{className:"modal-foot"},c.createElement("div",null,c.createElement(C.h,{disabled:void 0===a},Object(h.k)("add_verb")),c.createElement(C.g,{onClick:e},Object(h.k)("cancel"))))))}}var A=n(622);function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){z(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function H(e){const{collapsed:t,project:n,channels:o}=e,[i,a]=c.useState(t);return c.createElement(A.a,{onClick:()=>a(!i),open:!i,title:c.createElement("h4",{className:"display-inline-block"},n.projectName)},c.createElement("table",{className:"data zebra notifications-table",key:n.project},c.createElement("thead",null,c.createElement("tr",null,c.createElement("th",{"aria-label":Object(h.k)("project")}),o.map(e=>c.createElement("th",{className:"text-center",key:e},c.createElement("h4",null,Object(h.k)("notification.channel",e)))))),c.createElement(u.a,{channels:e.channels,checkboxId:(t,n)=>"project-notification-".concat(e.project.project,"-").concat(t,"-").concat(n),notifications:e.notifications,onAdd:({channel:t,type:n})=>{e.addNotification(q({},e.project,{channel:t,type:n}))},onRemove:({channel:t,type:n})=>{e.removeNotification(q({},e.project,{channel:t,type:n}))},project:!0,types:e.types})))}function U(e){return void 0!==e.project&&void 0!==e.projectName}class R extends c.PureComponent{constructor(){super(...arguments),this.state={addedProjects:[],search:"",showModal:!1},this.filterSearch=(e,t)=>e.projectName&&e.projectName.toLowerCase().includes(t),this.handleAddProject=e=>{this.setState(t=>({addedProjects:[...t.addedProjects,e]}))},this.handleSearch=(e="")=>{this.setState({search:e.toLowerCase()})},this.handleSubmit=e=>{e&&this.handleAddProject(e),this.closeModal()},this.closeModal=()=>{this.setState({showModal:!1})},this.openModal=()=>{this.setState({showModal:!0})},this.removeNotification=(e,t)=>{const n=t.find(t=>t.project===e.project);n&&this.handleAddProject(n),this.props.removeNotification(e)}}render(){const{notifications:e}=this.props,{addedProjects:t,search:n}=this.state,o=y()(e,e=>e.project).filter(U),i=S()(e,e=>e.project),a=y()([...t,...o],e=>e.project),r=O()(a,"projectName").filter(e=>this.filterSearch(e,n)),s=Object.keys(i).length>3;return c.createElement("section",{className:"boxed-group","data-test":"account__project-notifications"},c.createElement("div",{className:"boxed-group-inner"},c.createElement("div",{className:"page-actions"},c.createElement(C.a,{onClick:this.openModal},c.createElement("span",{"data-test":"account__add-project-notification"},Object(h.k)("my_profile.per_project_notifications.add")))),c.createElement("h2",null,Object(h.k)("my_profile.per_project_notifications.title"))),this.state.showModal&&c.createElement(L,{addedProjects:a,closeModal:this.closeModal,onSubmit:this.handleSubmit}),c.createElement("div",{className:"boxed-group-inner"},0===a.length&&c.createElement("div",{className:"note"},Object(h.k)("my_account.no_project_notifications")),a.length>0&&c.createElement("div",{className:"big-spacer-bottom"},c.createElement(w.a,{onChange:this.handleSearch,placeholder:Object(h.k)("search.search_for_projects")})),r.map(e=>{const n=!t.find(t=>t.project===e.project)&&s;return c.createElement(H,{addNotification:this.props.addNotification,channels:this.props.channels,collapsed:n,key:e.project,notifications:i[e.project]||[],project:e,removeNotification:e=>this.removeNotification(e,a),types:this.props.types})})))}}function K(e){const{addNotification:t,channels:n,globalTypes:o,loading:r,notifications:d,perProjectTypes:u,removeNotification:p}=e,[m,b]=i()(d,e=>!e.project);return c.createElement("div",{className:"account-body account-container"},c.createElement(a.a,{defer:!1,title:Object(h.k)("my_account.notifications")}),c.createElement(s.a,{variant:"info"},Object(h.k)("notification.dispatcher.information")),c.createElement(l.a,{loading:r},d&&c.createElement(c.Fragment,null,c.createElement(k,{addNotification:t,channels:n,notifications:m,removeNotification:p,types:o}),c.createElement(R,{addNotification:t,channels:n,notifications:b,removeNotification:p,types:u}))))}t.default=Object(r.a)(K)},391:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n(366),i=n(389);function c(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},c=Object.keys(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}class a extends o.Component{constructor(){super(...arguments),this.mounted=!1,this.state={submitting:!1},this.stopSubmitting=()=>{this.mounted&&this.setState({submitting:!1})},this.handleCloseClick=e=>{e&&(e.preventDefault(),e.currentTarget.blur()),this.props.onClose()},this.handleFormSubmit=e=>{e.preventDefault(),this.submit()},this.handleSubmitClick=e=>{e&&(e.preventDefault(),e.currentTarget.blur()),this.submit()},this.submit=()=>{const e=this.props.onSubmit();e&&(this.setState({submitting:!0}),e.then(this.stopSubmitting,this.stopSubmitting))}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const e=this.props,{children:t,header:n,onClose:a,onSubmit:r}=e,s=c(e,["children","header","onClose","onSubmit"]);return o.createElement(i.a,Object.assign({contentLabel:n,onRequestClose:a},s),t({onCloseClick:this.handleCloseClick,onFormSubmit:this.handleFormSubmit,onSubmitClick:this.handleSubmitClick,submitting:this.state.submitting}))}}},403:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n(367),i=n(366),c=n(376);n(426);class a extends i.PureComponent{constructor(){super(...arguments),this.handleClick=e=>{e.preventDefault(),e.currentTarget.blur(),this.props.disabled||this.props.onCheck(!this.props.checked,this.props.id)}}render(){const{checked:e,children:t,disabled:n,id:a,loading:r,right:s,thirdState:l,title:h}=this.props,d=o("icon-checkbox",{"icon-checkbox-checked":e,"icon-checkbox-single":l,"icon-checkbox-disabled":n});return t?i.createElement("a",{"aria-checked":e,className:o("link-checkbox",this.props.className,{note:n,disabled:n}),href:"#",id:a,onClick:this.handleClick,role:"checkbox",title:h},s&&t,i.createElement(c.a,{loading:Boolean(r)},i.createElement("i",{className:d})),!s&&t):r?i.createElement(c.a,null):i.createElement("a",{"aria-checked":e,className:o(d,this.props.className),href:"#",id:a,onClick:this.handleClick,role:"checkbox",title:h})}}a.defaultProps={thirdState:!1}},426:function(e,t,n){var o=n(369),i=n(427);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var c={insert:"head",singleton:!1},a=(o(i,c),i.locals?i.locals:{});e.exports=a},427:function(e,t,n){(t=n(370)(!1)).push([e.i,".icon-checkbox{display:inline-block;line-height:1;vertical-align:top;padding:1px 2px;box-sizing:border-box}a.icon-checkbox{border-bottom:none}.icon-checkbox:focus{outline:none}.icon-checkbox:before{content:\" \";display:inline-block;width:10px;height:10px;border:1px solid #236a97;border-radius:2px;transition:border-color .2s ease,background-color .2s ease,background-image .2s ease,box-shadow .4s ease}.icon-checkbox:not(.icon-checkbox-disabled):focus:before,.link-checkbox:not(.disabled):focus:focus .icon-checkbox:before{box-shadow:0 0 0 3px rgba(35,106,151,.25)}.icon-checkbox-checked:before{background-color:#4b9fd5;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 14 14' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' clip-rule='evenodd' stroke-linejoin='round' stroke-miterlimit='1.414'%3E%3Cpath d='M12 4.665c0 .172-.06.318-.18.438l-5.55 5.55c-.12.12-.266.18-.438.18s-.318-.06-.438-.18L2.18 7.438C2.06 7.317 2 7.17 2 7s.06-.318.18-.44l.878-.876c.12-.12.267-.18.44-.18.17 0 .317.06.437.18l1.897 1.903 4.233-4.24c.12-.12.266-.18.438-.18s.32.06.44.18l.876.88c.12.12.18.265.18.438z' fill='%23fff' fill-rule='nonzero'/%3E%3C/svg%3E\");border-color:#4b9fd5}.icon-checkbox-checked.icon-checkbox-single:before{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 14 14' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' clip-rule='evenodd' stroke-linejoin='round' stroke-miterlimit='1.414'%3E%3Cpath d='M10 4.698A.697.697 0 0 0 9.302 4H4.698A.697.697 0 0 0 4 4.698v4.604c0 .386.312.698.698.698h4.604A.697.697 0 0 0 10 9.302V4.698z' fill='%23fff'/%3E%3C/svg%3E\")}.icon-checkbox-disabled:before{border:1px solid #bbb;cursor:not-allowed}.icon-checkbox-disabled.icon-checkbox-checked:before{background-color:#bbb}.icon-checkbox-invisible{visibility:hidden}.link-checkbox{color:inherit;border-bottom:none}.link-checkbox.disabled,.link-checkbox.disabled:hover,.link-checkbox.disabled label{color:#666;cursor:not-allowed}.link-checkbox:active,.link-checkbox:focus,.link-checkbox:hover{color:inherit}",""]),e.exports=t},445:function(e,t,n){var o=n(52),i=n(481),c=Object.prototype.hasOwnProperty,a=i((function(e,t,n){c.call(e,n)?e[n].push(t):o(e,n,[t])}));e.exports=a},466:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n(366),i=n(372);function c(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},c=Object.keys(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function a(e){let{fill:t="currentColor"}=e,n=c(e,["fill"]);return o.createElement(i.a,Object.assign({},n),o.createElement("path",{d:"M7.72 11.596L3.119 6.992A.382.382 0 0 1 3 6.713c0-.108.04-.2.118-.279l1.03-1.03a.382.382 0 0 1 .278-.117c.108 0 .201.04.28.117L8 8.7l3.294-3.295a.382.382 0 0 1 .28-.117c.108 0 .2.04.279.117l1.03 1.03a.382.382 0 0 1 .117.28c0 .107-.04.2-.118.278L8.28 11.596a.382.382 0 0 1-.279.117.382.382 0 0 1-.28-.117z",style:{fill:t}}))}},484:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n(366),i=n(466),c=n(460);function a(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},c=Object.keys(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function r(e){let{open:t}=e,n=a(e,["open"]);return t?o.createElement(i.a,Object.assign({},n)):o.createElement(c.a,Object.assign({},n))}},544:function(e,t,n){var o=n(481)((function(e,t,n){e[n?0:1].push(t)}),(function(){return[[],[]]}));e.exports=o},622:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n(367),i=n(366),c=n(484);class a extends i.PureComponent{constructor(){super(...arguments),this.state={hoveringInner:!1},this.handleClick=()=>{this.props.onClick(this.props.data)},this.onDetailEnter=()=>{this.setState({hoveringInner:!0})},this.onDetailLeave=()=>{this.setState({hoveringInner:!1})}}render(){const{className:e,open:t,renderHeader:n,title:a}=this.props;return i.createElement("div",{className:o("boxed-group boxed-group-accordion",e,{"no-hover":this.state.hoveringInner})},i.createElement("div",{className:"boxed-group-header",onClick:this.handleClick,role:"listitem"},i.createElement("span",{className:"boxed-group-accordion-title"},i.createElement(c.a,{className:"little-spacer-right",open:t}),a),n&&n()),t&&i.createElement("div",{className:"boxed-group-inner",onMouseEnter:this.onDetailEnter,onMouseLeave:this.onDetailLeave},this.props.children))}}},766:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n(366),i=n(403),c=n(6);class a extends o.PureComponent{isEnabled(e,t){return!!this.props.notifications.find(n=>n.type===e&&n.channel===t)}handleCheck(e,t,n){n?this.props.onAdd({type:e,channel:t}):this.props.onRemove({type:e,channel:t})}getDispatcherLabel(e){const t=["notification.dispatcher",e],n=[...t,"project"];return this.props.project&&Object(c.i)(...n)?Object(c.k)(...n):Object(c.k)(...t)}render(){const{channels:e,checkboxId:t,types:n}=this.props;return o.createElement("tbody",null,n.map(n=>o.createElement("tr",{key:n},o.createElement("td",null,this.getDispatcherLabel(n)),e.map(e=>o.createElement("td",{className:"text-center",key:e},o.createElement(i.a,{checked:this.isEnabled(n,e),id:t(n,e),onCheck:t=>this.handleCheck(n,e,t)}))))))}}},831:function(e,t,n){var o=n(753);e.exports=function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?o(e,void 0,t):[]}},946:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var o=n(831),i=n.n(o),c=n(366),a=n(381),r=n(4);var s=n(527);function l(e){class t extends c.Component{constructor(){super(...arguments),this.mounted=!1,this.state={channels:[],globalTypes:[],loading:!0,notifications:[],perProjectTypes:[]},this.fetchNotifications=()=>{Object(r.d)("/api/notifications/list").catch(a.a).then(e=>{this.mounted&&this.setState({channels:e.channels,globalTypes:e.globalTypes,loading:!1,notifications:e.notifications,perProjectTypes:e.perProjectTypes})},()=>{this.mounted&&this.setState({loading:!1})})},this.addNotificationToState=e=>{this.setState(t=>({notifications:i()([...t.notifications,e],this.areNotificationsEqual)}))},this.removeNotificationFromState=e=>{this.setState(t=>({notifications:t.notifications.filter(t=>!this.areNotificationsEqual(t,e))}))},this.addNotification=e=>{this.addNotificationToState(e),function(e){return Object(r.i)("/api/notifications/add",e).catch(a.a)}({channel:e.channel,project:e.project,type:e.type}).catch(()=>{this.removeNotificationFromState(e)})},this.removeNotification=e=>{this.removeNotificationFromState(e),function(e){return Object(r.i)("/api/notifications/remove",e).catch(a.a)}({channel:e.channel,project:e.project,type:e.type}).catch(()=>{this.addNotificationToState(e)})},this.areNotificationsEqual=(e,t)=>e.channel===t.channel&&e.type===t.type&&e.project===t.project}componentDidMount(){this.mounted=!0,this.fetchNotifications()}componentWillUnmount(){this.mounted=!1}render(){const{channels:t,globalTypes:n,loading:o,notifications:i,perProjectTypes:a}=this.state;return c.createElement(e,Object.assign({},this.props,{addNotification:this.addNotification,channels:t,globalTypes:n,loading:o,notifications:i,perProjectTypes:a,removeNotification:this.removeNotification}))}}return t.displayName=Object(s.a)(e,"withNotifications"),t}}}]);
//# sourceMappingURL=311.m.1a852b5c.chunk.js.map