(window.webpackJsonp=window.webpackJsonp||[]).push([[333],{1804:function(e,s,t){"use strict";t.r(s),t.d(s,"default",(function(){return y}));var r=t(405),o=t.n(r),i=t(366),n=t(393),a=t(538),u=t(396),p=t(6),l=(t(918),t(382)),g=t(404),m=t(385),h=t(390),d=t(941),c=t(919),P=t(629);class f extends i.PureComponent{constructor(){super(...arguments),this.handleToggleUser=(e,s)=>e.permissions.includes(s)?this.props.revokePermissionFromUser(e.login,s):this.props.grantPermissionToUser(e.login,s),this.handleToggleGroup=(e,s)=>e.permissions.includes(s)?this.props.revokePermissionFromGroup(e.name,s):this.props.grantPermissionToGroup(e.name,s)}render(){const{appState:e,filter:s,groups:t,groupsPaging:r,users:o,usersPaging:n}=this.props,a=e.qualifiers.includes(h.a.Portfolio),u=e.qualifiers.includes(h.a.Application),p=Object(P.d)(Object(P.e)(P.c,u,a),"global_permissions");let l=0,m=0;return"users"!==s&&(l+=t.length,m+=r?r.total:t.length),"groups"!==s&&(l+=o.length,m+=n?n.total:o.length),i.createElement(i.Fragment,null,i.createElement(d.a,{filter:this.props.filter,groups:this.props.groups,loading:this.props.loading,onToggleGroup:this.handleToggleGroup,onToggleUser:this.handleToggleUser,permissions:p,query:this.props.query,users:this.props.users},i.createElement(c.a,{filter:this.props.filter,onFilter:this.props.onFilter,onSearch:this.props.onSearch,query:this.props.query})),i.createElement(g.a,{count:l,loadMore:this.props.onLoadMore,total:m}))}}var v=Object(l.b)(e=>({appState:Object(m.getAppState)(e)}))(f);class b extends i.PureComponent{render(){return i.createElement("header",{className:"page-header"},i.createElement("h1",{className:"page-title"},Object(p.k)("global_permissions.page")),this.props.loading&&i.createElement("i",{className:"spinner"}),i.createElement("div",{className:"page-description"},Object(p.k)("global_permissions.page.description")))}}function S(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);s&&(r=r.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),t.push.apply(t,r)}return t}function O(e){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?S(Object(t),!0).forEach((function(s){j(e,s,t[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):S(Object(t)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))}))}return e}function j(e,s,t){return s in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}class y extends i.PureComponent{constructor(e){super(e),this.mounted=!1,this.loadUsersAndGroups=(e,s)=>{const{filter:t,query:r}=this.state,o="groups"!==t?a.i({q:r||void 0,p:e}):Promise.resolve({paging:void 0,users:[]}),i="users"!==t?a.h({q:r||void 0,p:s}):Promise.resolve({paging:void 0,groups:[]});return Promise.all([o,i])},this.loadHolders=()=>(this.setState({loading:!0}),this.loadUsersAndGroups().then(([e,s])=>{this.mounted&&this.setState({groups:s.groups,groupsPaging:s.paging,loading:!1,users:e.users,usersPaging:e.paging})},this.stopLoading)),this.onLoadMore=()=>{const{usersPaging:e,groupsPaging:s}=this.state;return this.setState({loading:!0}),this.loadUsersAndGroups(e?e.pageIndex+1:1,s?s.pageIndex+1:1).then(([e,s])=>{this.mounted&&this.setState(({groups:t,users:r})=>({groups:[...t,...s.groups],groupsPaging:s.paging,loading:!1,users:[...r,...e.users],usersPaging:e.paging}))},this.stopLoading)},this.onFilter=e=>{this.setState({filter:e},this.loadHolders)},this.onSearch=e=>{this.setState({query:e},this.loadHolders)},this.addPermissionToGroup=(e,s,t)=>e.map(e=>e.name===s?O({},e,{permissions:[...e.permissions,t]}):e),this.addPermissionToUser=(e,s,t)=>e.map(e=>e.login===s?O({},e,{permissions:[...e.permissions,t]}):e),this.removePermissionFromGroup=(e,s,t)=>e.map(e=>e.name===s?O({},e,{permissions:o()(e.permissions,t)}):e),this.removePermissionFromUser=(e,s,t)=>e.map(e=>e.login===s?O({},e,{permissions:o()(e.permissions,t)}):e),this.grantPermissionToGroup=(e,s)=>this.mounted?(this.setState(({groups:t})=>({groups:this.addPermissionToGroup(t,e,s)})),a.o({groupName:e,permission:s}).then(()=>{},()=>{this.mounted&&this.setState(({groups:t})=>({groups:this.removePermissionFromGroup(t,e,s)}))})):Promise.resolve(),this.grantPermissionToUser=(e,s)=>this.mounted?(this.setState(({users:t})=>({users:this.addPermissionToUser(t,e,s)})),a.p({login:e,permission:s}).then(()=>{},()=>{this.mounted&&this.setState(({users:t})=>({users:this.removePermissionFromUser(t,e,s)}))})):Promise.resolve(),this.revokePermissionFromGroup=(e,s)=>this.mounted?(this.setState(({groups:t})=>({groups:this.removePermissionFromGroup(t,e,s)})),a.t({groupName:e,permission:s}).then(()=>{},()=>{this.mounted&&this.setState(({groups:t})=>({groups:this.addPermissionToGroup(t,e,s)}))})):Promise.resolve(),this.revokePermissionFromUser=(e,s)=>this.mounted?(this.setState(({users:t})=>({users:this.removePermissionFromUser(t,e,s)})),a.u({login:e,permission:s}).then(()=>{},()=>{this.mounted&&this.setState(({users:t})=>({users:this.addPermissionToUser(t,e,s)}))})):Promise.resolve(),this.stopLoading=()=>{this.mounted&&this.setState({loading:!1})},this.state={filter:"all",groups:[],loading:!0,query:"",users:[]}}componentDidMount(){this.mounted=!0,this.loadHolders()}componentWillUnmount(){this.mounted=!1}render(){return i.createElement("div",{className:"page page-limited"},i.createElement(u.a,{suggestions:"global_permissions"}),i.createElement(n.a,{defer:!1,title:Object(p.k)("global_permissions.permission")}),i.createElement(b,{loading:this.state.loading}),i.createElement(v,{filter:this.state.filter,grantPermissionToGroup:this.grantPermissionToGroup,grantPermissionToUser:this.grantPermissionToUser,groups:this.state.groups,groupsPaging:this.state.groupsPaging,loadHolders:this.loadHolders,loading:this.state.loading,onFilter:this.onFilter,onLoadMore:this.onLoadMore,onSearch:this.onSearch,query:this.state.query,revokePermissionFromGroup:this.revokePermissionFromGroup,revokePermissionFromUser:this.revokePermissionFromUser,users:this.state.users,usersPaging:this.state.usersPaging}))}}},396:function(e,s,t){"use strict";t.d(s,"a",(function(){return i}));var r=t(366),o=t(435);function i({suggestions:e}){return r.createElement(o.a.Consumer,null,({addSuggestions:s,removeSuggestions:t})=>r.createElement(n,{addSuggestions:s,removeSuggestions:t,suggestions:e}))}class n extends r.PureComponent{componentDidMount(){this.props.addSuggestions(this.props.suggestions)}componentDidUpdate(e){e.suggestions!==this.props.suggestions&&(this.props.removeSuggestions(this.props.suggestions),this.props.addSuggestions(e.suggestions))}componentWillUnmount(){this.props.removeSuggestions(this.props.suggestions)}render(){return null}}},404:function(e,s,t){"use strict";t.d(s,"a",(function(){return p}));var r=t(367),o=t(366),i=t(6),n=t(377),a=t(376),u=t(368);function p(e){const{className:s,count:t,loading:p,needReload:l,total:g,ready:m=!0}=e,h=g&&g>t;let d;return l&&e.reload?d=o.createElement(u.a,{className:"spacer-left","data-test":"reload",disabled:p,onClick:e.reload},Object(i.k)("reload")):h&&e.loadMore&&(d=o.createElement(u.a,{className:"spacer-left",disabled:p,"data-test":"show-more",onClick:e.loadMore},Object(i.k)("show_more"))),o.createElement("footer",{className:r("spacer-top note text-center",{"new-loading":!m},s)},Object(i.l)("x_of_y_shown",Object(n.formatMeasure)(t,"INT",null),Object(n.formatMeasure)(g,"INT",null)),d,p&&o.createElement(a.a,{className:"text-bottom spacer-left position-absolute"}))}},405:function(e,s,t){var r=t(420),o=t(450),i=t(413),n=o((function(e,s){return i(e)?r(e,s):[]}));e.exports=n},413:function(e,s,t){var r=t(449),o=t(7);e.exports=function(e){return o(e)&&r(e)}},420:function(e,s,t){var r=t(49),o=t(486),i=t(487),n=t(23),a=t(51),u=t(50);e.exports=function(e,s,t,p){var l=-1,g=o,m=!0,h=e.length,d=[],c=s.length;if(!h)return d;t&&(s=n(s,a(t))),p?(g=i,m=!1):s.length>=200&&(g=u,m=!1,s=new r(s));e:for(;++l<h;){var P=e[l],f=null==t?P:t(P);if(P=p||0!==P?P:0,m&&f==f){for(var v=c;v--;)if(s[v]===f)continue e;d.push(P)}else g(s,f,p)||d.push(P)}return d}},544:function(e,s,t){var r=t(481)((function(e,s,t){e[t?0:1].push(s)}),(function(){return[[],[]]}));e.exports=r}}]);
//# sourceMappingURL=333.m.799e4066.chunk.js.map