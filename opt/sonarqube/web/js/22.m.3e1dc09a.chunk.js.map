{"version":3,"sources":["webpack:///./src/main/js/components/common/AnalysisWarningsModal.tsx","webpack:///./src/main/js/helpers/sanitize.ts","webpack:///./src/main/js/components/icons/WarningIcon.tsx"],"names":["AnalysisWarningsModal","props","super","mounted","handleDismissMessage","async","componentKey","this","undefined","setState","dismissedWarning","messageKey","onWarningDismiss","e","loadWarnings","loading","warnings","taskId","map","w","key","message","dismissable","state","prevProps","currentUser","header","contentLabel","onRequestClose","onClose","className","dangerouslySetInnerHTML","__html","trim","replace","isLoggedIn","disabled","Boolean","onClick","sanitizeStringRestricted","html","ALLOWED_TAGS","ALLOWED_ATTR","sanitizeString","USE_PROFILES","WarningIcon","fill","iconProps","d","style","warningIconColor"],"mappings":"4FAAA,gJA6CO,MAAMA,UAA8B,gBAGzC,YAAYC,GACVC,MAAMD,GAHR,KAAAE,SAAU,EA8BV,KAAAC,qBAAuBC,UACrB,MAAM,aAAEC,GAAiBC,KAAKN,MAE9B,QAAqBO,IAAjBF,EAAJ,CAIAC,KAAKE,SAAS,CAAEC,iBAAkBC,IAElC,UACQ,YAAuBL,EAAcK,GAEvCJ,KAAKN,MAAMW,kBACbL,KAAKN,MAAMW,mBAEb,MAAOC,IAILN,KAAKJ,SACPI,KAAKE,SAAS,CAAEC,sBAAkBF,MAItC,KAAAM,aAAeT,UACbE,KAAKE,SAAS,CAAEM,SAAS,IACzB,IACE,MAAM,SAAEC,EAAW,UAAa,YAAQC,EAAQ,CAAC,aAE7CV,KAAKJ,SACPI,KAAKE,SAAS,CACZM,SAAS,EACTC,SAAUA,EAASE,IAAIC,IAAC,CAAOC,IAAKD,EAAGE,QAASF,EAAGG,aAAa,OAGpE,MAAOT,GACHN,KAAKJ,SACPI,KAAKE,SAAS,CAAEM,SAAS,MA/D7BR,KAAKgB,MAAQ,CACXR,SAAUd,EAAMe,SAChBA,SAAUf,EAAMe,UAAY,IAIhC,oBACET,KAAKJ,SAAU,GACVI,KAAKN,MAAMe,UAAYT,KAAKN,MAAMgB,QACrCV,KAAKO,aAAaP,KAAKN,MAAMgB,QAIjC,mBAAmBO,GACjB,MAAM,OAAEP,EAAF,SAAUD,GAAaT,KAAKN,OAC7Be,GAAYC,GAAUO,EAAUP,SAAWA,EAC9CV,KAAKO,aAAaG,GACTD,GAAYQ,EAAUR,WAAaA,GAC5CT,KAAKE,SAAS,CAAEO,aAIpB,uBACET,KAAKJ,SAAU,EA6CjB,SACE,MAAM,YAAEsB,GAAgBlB,KAAKN,OACvB,QAAEc,EAAF,iBAAWL,EAAX,SAA6BM,GAAaT,KAAKgB,MAE/CG,EAAS,YAAU,YAEzB,OACE,gBAAC,IAAK,CAACC,aAAcD,EAAQE,eAAgBrB,KAAKN,MAAM4B,SACtD,0BAAQC,UAAU,cAChB,0BAAKJ,IAGP,uBAAKI,UAAU,mDACb,gBAAC,IAAe,CAACf,QAASA,GACvBC,EAASE,IAAI,EAAGI,cAAaF,MAAKC,aACjC,uBAAKS,UAAU,uBAAuBV,IAAKA,GACzC,gBAAC,IAAW,CAACU,UAAU,2BACvB,uBAAKA,UAAU,4BACb,wBAEEC,wBAAyB,CACvBC,OAAQ,YAAyBX,EAAQY,OAAOC,QAAQ,MAAO,cAIlEZ,GAAeG,EAAYU,YAC1B,uBAAKL,UAAU,kCACb,gBAAC,IAAU,CACTA,UAAU,kBACVM,SAAUC,QAAQ3B,GAClB4B,QAAS,KACP/B,KAAKH,qBAAqBgB,KAE3B,YAAU,wBAEZV,IAAqBU,GAAO,qBAAGU,UAAU,8BASxD,0BAAQA,UAAU,cAChB,gBAAC,IAAU,CAACA,UAAU,iBAAiBQ,QAAS/B,KAAKN,MAAM4B,SACxD,YAAU,aAQR,sBAAgB7B,I,iCC5K/B,iFAsBO,SAASuC,EAAyBC,GACvC,OAAO,mBAASA,EAAM,CACpBC,aAAc,CAAC,IAAK,KAAM,OAAQ,IAAK,KAAM,IAAK,SAAU,KAAM,KAClEC,aAAc,CAAC,SAAU,UAItB,SAASC,EAAeH,GAC7B,OAAO,mBAASA,EAAM,CAAEI,aAAc,CAAEJ,MAAM,O,sdCPjC,SAASK,EAAV,GAAuD,IAAjC,KAAEC,GAA+B,EAAtBC,EAAsB,cACnE,OACE,gBAAC,IAAI,iBAAKA,GACR,wBACEC,EAAE,oZACFC,MAAO,CAAEH,KAAMA,GAAQ,SAAOI","file":"js/22.m.3e1dc09a.chunk.js","sourcesContent":["/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { dismissAnalysisWarning, getTask } from '../../api/ce';\nimport { ButtonLink } from '../../components/controls/buttons';\nimport Modal from '../../components/controls/Modal';\nimport WarningIcon from '../../components/icons/WarningIcon';\nimport DeferredSpinner from '../../components/ui/DeferredSpinner';\nimport { translate } from '../../helpers/l10n';\nimport { sanitizeStringRestricted } from '../../helpers/sanitize';\nimport { TaskWarning } from '../../types/tasks';\nimport { withCurrentUser } from '../hoc/withCurrentUser';\n\ninterface Props {\n  componentKey?: string;\n  currentUser: T.CurrentUser;\n  onClose: () => void;\n  onWarningDismiss?: () => void;\n  taskId?: string;\n  warnings?: TaskWarning[];\n}\n\ninterface State {\n  loading: boolean;\n  dismissedWarning?: string;\n  warnings: TaskWarning[];\n}\n\nexport class AnalysisWarningsModal extends React.PureComponent<Props, State> {\n  mounted = false;\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      loading: !props.warnings,\n      warnings: props.warnings || []\n    };\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n    if (!this.props.warnings && this.props.taskId) {\n      this.loadWarnings(this.props.taskId);\n    }\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const { taskId, warnings } = this.props;\n    if (!warnings && taskId && prevProps.taskId !== taskId) {\n      this.loadWarnings(taskId);\n    } else if (warnings && prevProps.warnings !== warnings) {\n      this.setState({ warnings });\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  handleDismissMessage = async (messageKey: string) => {\n    const { componentKey } = this.props;\n\n    if (componentKey === undefined) {\n      return;\n    }\n\n    this.setState({ dismissedWarning: messageKey });\n\n    try {\n      await dismissAnalysisWarning(componentKey, messageKey);\n\n      if (this.props.onWarningDismiss) {\n        this.props.onWarningDismiss();\n      }\n    } catch (e) {\n      // Noop\n    }\n\n    if (this.mounted) {\n      this.setState({ dismissedWarning: undefined });\n    }\n  };\n\n  loadWarnings = async (taskId: string) => {\n    this.setState({ loading: true });\n    try {\n      const { warnings = [] } = await getTask(taskId, ['warnings']);\n\n      if (this.mounted) {\n        this.setState({\n          loading: false,\n          warnings: warnings.map(w => ({ key: w, message: w, dismissable: false }))\n        });\n      }\n    } catch (e) {\n      if (this.mounted) {\n        this.setState({ loading: false });\n      }\n    }\n  };\n\n  render() {\n    const { currentUser } = this.props;\n    const { loading, dismissedWarning, warnings } = this.state;\n\n    const header = translate('warnings');\n\n    return (\n      <Modal contentLabel={header} onRequestClose={this.props.onClose}>\n        <header className=\"modal-head\">\n          <h2>{header}</h2>\n        </header>\n\n        <div className=\"modal-body modal-container js-analysis-warnings\">\n          <DeferredSpinner loading={loading}>\n            {warnings.map(({ dismissable, key, message }) => (\n              <div className=\"panel panel-vertical\" key={key}>\n                <WarningIcon className=\"pull-left spacer-right\" />\n                <div className=\"overflow-hidden markdown\">\n                  <span\n                    // eslint-disable-next-line react/no-danger\n                    dangerouslySetInnerHTML={{\n                      __html: sanitizeStringRestricted(message.trim().replace(/\\n/g, '<br />'))\n                    }}\n                  />\n\n                  {dismissable && currentUser.isLoggedIn && (\n                    <div className=\"spacer-top display-flex-inline\">\n                      <ButtonLink\n                        className=\"link-base-color\"\n                        disabled={Boolean(dismissedWarning)}\n                        onClick={() => {\n                          this.handleDismissMessage(key);\n                        }}>\n                        {translate('dismiss_permanently')}\n                      </ButtonLink>\n                      {dismissedWarning === key && <i className=\"spinner spacer-left\" />}\n                    </div>\n                  )}\n                </div>\n              </div>\n            ))}\n          </DeferredSpinner>\n        </div>\n\n        <footer className=\"modal-foot\">\n          <ButtonLink className=\"js-modal-close\" onClick={this.props.onClose}>\n            {translate('close')}\n          </ButtonLink>\n        </footer>\n      </Modal>\n    );\n  }\n}\n\nexport default withCurrentUser(AnalysisWarningsModal);\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\n\nimport { sanitize } from 'dompurify';\n\nexport function sanitizeStringRestricted(html: string) {\n  return sanitize(html, {\n    ALLOWED_TAGS: ['b', 'br', 'code', 'i', 'li', 'p', 'strong', 'ul', 'a'],\n    ALLOWED_ATTR: ['target', 'href']\n  });\n}\n\nexport function sanitizeString(html: string) {\n  return sanitize(html, { USE_PROFILES: { html: true } });\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { colors } from '../../app/theme';\nimport Icon, { IconProps } from './Icon';\n\nexport default function WarningIcon({ fill, ...iconProps }: IconProps) {\n  return (\n    <Icon {...iconProps}>\n      <path\n        d=\"M9 12.242v-1.484c0-.14-.11-.258-.25-.258h-1.5c-.14 0-.25.117-.25.258v1.484c0 .14.11.258.25.258h1.5c.14 0 .25-.117.25-.258zM8.984 9.32l.141-3.586a.189.189 0 0 0-.078-.148C9 5.546 8.93 5.5 8.859 5.5H7.141c-.07 0-.141.047-.188.086-.055.039-.078.117-.078.164l.133 3.57c0 .102.117.18.265.18H8.72c.14 0 .258-.078.265-.18zm-.109-7.297l6 11A1 1 0 0 1 14 14.5H2a1 1 0 0 1-.875-1.477l6-11a.994.994 0 0 1 1.75 0z\"\n        style={{ fill: fill || colors.warningIconColor }}\n      />\n    </Icon>\n  );\n}\n"],"sourceRoot":""}