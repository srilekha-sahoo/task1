{"version":3,"sources":["webpack:///./src/main/js/apps/permissions/global/components/AllHoldersList.tsx","webpack:///./src/main/js/apps/permissions/global/components/PageHeader.tsx","webpack:///./src/main/js/apps/permissions/global/components/App.tsx","webpack:///./src/main/js/app/components/embed-docs-modal/Suggestions.tsx","webpack:///./src/main/js/components/controls/ListFooter.tsx","webpack:///./node_modules/lodash/without.js","webpack:///./node_modules/lodash/isArrayLikeObject.js","webpack:///./node_modules/lodash/_baseDifference.js","webpack:///./node_modules/lodash/partition.js"],"names":["handleToggleUser","user","permission","permissions","includes","this","props","revokePermissionFromUser","login","grantPermissionToUser","handleToggleGroup","group","revokePermissionFromGroup","name","grantPermissionToGroup","appState","filter","groups","groupsPaging","users","usersPaging","hasPortfoliosEnabled","qualifiers","Portfolio","hasApplicationsEnabled","Application","count","total","length","HoldersList","loading","onToggleGroup","onToggleUser","query","SearchForm","onFilter","onSearch","ListFooter","loadMore","onLoadMore","state","className","super","mounted","loadUsersAndGroups","userPage","groupsPage","getUsers","q","undefined","p","Promise","resolve","paging","getGroups","all","loadHolders","setState","then","usersResponse","groupsResponse","stopLoading","pageIndex","addPermissionToGroup","map","candidate","addPermissionToUser","removePermissionFromGroup","removePermissionFromUser","groupName","Suggestions","suggestions","defer","title","Consumer","addSuggestions","removeSuggestions","SuggestionsInner","prevProps","needReload","ready","hasMore","button","reload","disabled","onClick","baseDifference","baseRest","isArrayLikeObject","without","array","values","module","exports","isArrayLike","isObjectLike","value","SetCache","arrayIncludes","arrayIncludesWith","arrayMap","baseUnary","cacheHas","iteratee","comparator","index","isCommon","result","valuesLength","outer","computed","valuesIndex","push","partition","createAggregator","key"],"mappings":"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","file":"js/333.m.799e4066.chunk.js","sourcesContent":["/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { connect } from 'react-redux';\nimport ListFooter from '../../../../components/controls/ListFooter';\nimport { getAppState, Store } from '../../../../store/rootReducer';\nimport { ComponentQualifier } from '../../../../types/component';\nimport HoldersList from '../../shared/components/HoldersList';\nimport SearchForm from '../../shared/components/SearchForm';\nimport {\n  convertToPermissionDefinitions,\n  filterPermissions,\n  PERMISSIONS_ORDER_GLOBAL\n} from '../../utils';\n\ninterface StateProps {\n  appState: Pick<T.AppState, 'qualifiers'>;\n}\n\ninterface OwnProps {\n  filter: string;\n  grantPermissionToGroup: (groupName: string, permission: string) => Promise<void>;\n  grantPermissionToUser: (login: string, permission: string) => Promise<void>;\n  groups: T.PermissionGroup[];\n  groupsPaging?: T.Paging;\n  loadHolders: () => void;\n  loading?: boolean;\n  onLoadMore: () => void;\n  onFilter: (filter: string) => void;\n  onSearch: (query: string) => void;\n  query: string;\n  revokePermissionFromGroup: (groupName: string, permission: string) => Promise<void>;\n  revokePermissionFromUser: (login: string, permission: string) => Promise<void>;\n  users: T.PermissionUser[];\n  usersPaging?: T.Paging;\n}\n\ntype Props = StateProps & OwnProps;\n\nexport class AllHoldersList extends React.PureComponent<Props> {\n  handleToggleUser = (user: T.PermissionUser, permission: string) => {\n    const hasPermission = user.permissions.includes(permission);\n    if (hasPermission) {\n      return this.props.revokePermissionFromUser(user.login, permission);\n    } else {\n      return this.props.grantPermissionToUser(user.login, permission);\n    }\n  };\n\n  handleToggleGroup = (group: T.PermissionGroup, permission: string) => {\n    const hasPermission = group.permissions.includes(permission);\n\n    if (hasPermission) {\n      return this.props.revokePermissionFromGroup(group.name, permission);\n    } else {\n      return this.props.grantPermissionToGroup(group.name, permission);\n    }\n  };\n\n  render() {\n    const { appState, filter, groups, groupsPaging, users, usersPaging } = this.props;\n    const l10nPrefix = 'global_permissions';\n\n    const hasPortfoliosEnabled = appState.qualifiers.includes(ComponentQualifier.Portfolio);\n    const hasApplicationsEnabled = appState.qualifiers.includes(ComponentQualifier.Application);\n    const permissions = convertToPermissionDefinitions(\n      filterPermissions(PERMISSIONS_ORDER_GLOBAL, hasApplicationsEnabled, hasPortfoliosEnabled),\n      l10nPrefix\n    );\n\n    let count = 0;\n    let total = 0;\n    if (filter !== 'users') {\n      count += groups.length;\n      total += groupsPaging ? groupsPaging.total : groups.length;\n    }\n    if (filter !== 'groups') {\n      count += users.length;\n      total += usersPaging ? usersPaging.total : users.length;\n    }\n\n    return (\n      <>\n        <HoldersList\n          filter={this.props.filter}\n          groups={this.props.groups}\n          loading={this.props.loading}\n          onToggleGroup={this.handleToggleGroup}\n          onToggleUser={this.handleToggleUser}\n          permissions={permissions}\n          query={this.props.query}\n          users={this.props.users}>\n          <SearchForm\n            filter={this.props.filter}\n            onFilter={this.props.onFilter}\n            onSearch={this.props.onSearch}\n            query={this.props.query}\n          />\n        </HoldersList>\n        <ListFooter count={count} loadMore={this.props.onLoadMore} total={total} />\n      </>\n    );\n  }\n}\n\nconst mapStateToProps = (state: Store): StateProps => ({\n  appState: getAppState(state)\n});\n\nexport default connect(mapStateToProps)(AllHoldersList);\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { translate } from '../../../../helpers/l10n';\n\ninterface Props {\n  loading?: boolean;\n}\n\nexport default class PageHeader extends React.PureComponent<Props> {\n  render() {\n    return (\n      <header className=\"page-header\">\n        <h1 className=\"page-title\">{translate('global_permissions.page')}</h1>\n\n        {this.props.loading && <i className=\"spinner\" />}\n\n        <div className=\"page-description\">{translate('global_permissions.page.description')}</div>\n      </header>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { without } from 'lodash';\nimport * as React from 'react';\nimport { Helmet } from 'react-helmet-async';\nimport * as api from '../../../../api/permissions';\nimport Suggestions from '../../../../app/components/embed-docs-modal/Suggestions';\nimport { translate } from '../../../../helpers/l10n';\nimport '../../styles.css';\nimport AllHoldersList from './AllHoldersList';\nimport PageHeader from './PageHeader';\n\ninterface State {\n  filter: 'all' | 'groups' | 'users';\n  groups: T.PermissionGroup[];\n  groupsPaging?: T.Paging;\n  loading: boolean;\n  query: string;\n  users: T.PermissionUser[];\n  usersPaging?: T.Paging;\n}\n\nexport default class App extends React.PureComponent<{}, State> {\n  mounted = false;\n\n  constructor(props: {}) {\n    super(props);\n    this.state = {\n      filter: 'all',\n      groups: [],\n      loading: true,\n      query: '',\n      users: []\n    };\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n    this.loadHolders();\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  loadUsersAndGroups = (userPage?: number, groupsPage?: number) => {\n    const { filter, query } = this.state;\n\n    const getUsers: Promise<{ paging?: T.Paging; users: T.PermissionUser[] }> =\n      filter !== 'groups'\n        ? api.getGlobalPermissionsUsers({\n            q: query || undefined,\n            p: userPage\n          })\n        : Promise.resolve({ paging: undefined, users: [] });\n\n    const getGroups: Promise<{ paging?: T.Paging; groups: T.PermissionGroup[] }> =\n      filter !== 'users'\n        ? api.getGlobalPermissionsGroups({\n            q: query || undefined,\n            p: groupsPage\n          })\n        : Promise.resolve({ paging: undefined, groups: [] });\n\n    return Promise.all([getUsers, getGroups]);\n  };\n\n  loadHolders = () => {\n    this.setState({ loading: true });\n    return this.loadUsersAndGroups().then(([usersResponse, groupsResponse]) => {\n      if (this.mounted) {\n        this.setState({\n          groups: groupsResponse.groups,\n          groupsPaging: groupsResponse.paging,\n          loading: false,\n          users: usersResponse.users,\n          usersPaging: usersResponse.paging\n        });\n      }\n    }, this.stopLoading);\n  };\n\n  onLoadMore = () => {\n    const { usersPaging, groupsPaging } = this.state;\n    this.setState({ loading: true });\n    return this.loadUsersAndGroups(\n      usersPaging ? usersPaging.pageIndex + 1 : 1,\n      groupsPaging ? groupsPaging.pageIndex + 1 : 1\n    ).then(([usersResponse, groupsResponse]) => {\n      if (this.mounted) {\n        this.setState(({ groups, users }) => ({\n          groups: [...groups, ...groupsResponse.groups],\n          groupsPaging: groupsResponse.paging,\n          loading: false,\n          users: [...users, ...usersResponse.users],\n          usersPaging: usersResponse.paging\n        }));\n      }\n    }, this.stopLoading);\n  };\n\n  onFilter = (filter: 'all' | 'groups' | 'users') => {\n    this.setState({ filter }, this.loadHolders);\n  };\n\n  onSearch = (query: string) => {\n    this.setState({ query }, this.loadHolders);\n  };\n\n  addPermissionToGroup = (groups: T.PermissionGroup[], group: string, permission: string) => {\n    return groups.map(candidate =>\n      candidate.name === group\n        ? { ...candidate, permissions: [...candidate.permissions, permission] }\n        : candidate\n    );\n  };\n\n  addPermissionToUser = (users: T.PermissionUser[], user: string, permission: string) => {\n    return users.map(candidate =>\n      candidate.login === user\n        ? { ...candidate, permissions: [...candidate.permissions, permission] }\n        : candidate\n    );\n  };\n\n  removePermissionFromGroup = (groups: T.PermissionGroup[], group: string, permission: string) => {\n    return groups.map(candidate =>\n      candidate.name === group\n        ? { ...candidate, permissions: without(candidate.permissions, permission) }\n        : candidate\n    );\n  };\n\n  removePermissionFromUser = (users: T.PermissionUser[], user: string, permission: string) => {\n    return users.map(candidate =>\n      candidate.login === user\n        ? { ...candidate, permissions: without(candidate.permissions, permission) }\n        : candidate\n    );\n  };\n\n  grantPermissionToGroup = (group: string, permission: string) => {\n    if (this.mounted) {\n      this.setState(({ groups }) => ({\n        groups: this.addPermissionToGroup(groups, group, permission)\n      }));\n      return api\n        .grantPermissionToGroup({\n          groupName: group,\n          permission\n        })\n        .then(\n          () => {},\n          () => {\n            if (this.mounted) {\n              this.setState(({ groups }) => ({\n                groups: this.removePermissionFromGroup(groups, group, permission)\n              }));\n            }\n          }\n        );\n    }\n    return Promise.resolve();\n  };\n\n  grantPermissionToUser = (user: string, permission: string) => {\n    if (this.mounted) {\n      this.setState(({ users }) => ({\n        users: this.addPermissionToUser(users, user, permission)\n      }));\n      return api\n        .grantPermissionToUser({\n          login: user,\n          permission\n        })\n        .then(\n          () => {},\n          () => {\n            if (this.mounted) {\n              this.setState(({ users }) => ({\n                users: this.removePermissionFromUser(users, user, permission)\n              }));\n            }\n          }\n        );\n    }\n    return Promise.resolve();\n  };\n\n  revokePermissionFromGroup = (group: string, permission: string) => {\n    if (this.mounted) {\n      this.setState(({ groups }) => ({\n        groups: this.removePermissionFromGroup(groups, group, permission)\n      }));\n      return api\n        .revokePermissionFromGroup({\n          groupName: group,\n          permission\n        })\n        .then(\n          () => {},\n          () => {\n            if (this.mounted) {\n              this.setState(({ groups }) => ({\n                groups: this.addPermissionToGroup(groups, group, permission)\n              }));\n            }\n          }\n        );\n    }\n    return Promise.resolve();\n  };\n\n  revokePermissionFromUser = (user: string, permission: string) => {\n    if (this.mounted) {\n      this.setState(({ users }) => ({\n        users: this.removePermissionFromUser(users, user, permission)\n      }));\n      return api\n        .revokePermissionFromUser({\n          login: user,\n          permission\n        })\n        .then(\n          () => {},\n          () => {\n            if (this.mounted) {\n              this.setState(({ users }) => ({\n                users: this.addPermissionToUser(users, user, permission)\n              }));\n            }\n          }\n        );\n    }\n    return Promise.resolve();\n  };\n\n  stopLoading = () => {\n    if (this.mounted) {\n      this.setState({ loading: false });\n    }\n  };\n\n  render() {\n    return (\n      <div className=\"page page-limited\">\n        <Suggestions suggestions=\"global_permissions\" />\n        <Helmet defer={false} title={translate('global_permissions.permission')} />\n        <PageHeader loading={this.state.loading} />\n        <AllHoldersList\n          filter={this.state.filter}\n          grantPermissionToGroup={this.grantPermissionToGroup}\n          grantPermissionToUser={this.grantPermissionToUser}\n          groups={this.state.groups}\n          groupsPaging={this.state.groupsPaging}\n          loadHolders={this.loadHolders}\n          loading={this.state.loading}\n          onFilter={this.onFilter}\n          onLoadMore={this.onLoadMore}\n          onSearch={this.onSearch}\n          query={this.state.query}\n          revokePermissionFromGroup={this.revokePermissionFromGroup}\n          revokePermissionFromUser={this.revokePermissionFromUser}\n          users={this.state.users}\n          usersPaging={this.state.usersPaging}\n        />\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { SuggestionsContext } from './SuggestionsContext';\n\ninterface Props {\n  suggestions: string;\n}\n\nexport default function Suggestions({ suggestions }: Props) {\n  return (\n    <SuggestionsContext.Consumer>\n      {({ addSuggestions, removeSuggestions }) => (\n        <SuggestionsInner\n          addSuggestions={addSuggestions}\n          removeSuggestions={removeSuggestions}\n          suggestions={suggestions}\n        />\n      )}\n    </SuggestionsContext.Consumer>\n  );\n}\n\ninterface SuggestionsInnerProps {\n  addSuggestions: (key: string) => void;\n  removeSuggestions: (key: string) => void;\n  suggestions: string;\n}\n\nclass SuggestionsInner extends React.PureComponent<SuggestionsInnerProps> {\n  componentDidMount() {\n    this.props.addSuggestions(this.props.suggestions);\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (prevProps.suggestions !== this.props.suggestions) {\n      this.props.removeSuggestions(this.props.suggestions);\n      this.props.addSuggestions(prevProps.suggestions);\n    }\n  }\n\n  componentWillUnmount() {\n    this.props.removeSuggestions(this.props.suggestions);\n  }\n\n  render() {\n    return null;\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { translate, translateWithParameters } from '../../helpers/l10n';\nimport { formatMeasure } from '../../helpers/measures';\nimport DeferredSpinner from '../ui/DeferredSpinner';\nimport { Button } from './buttons';\n\nexport interface ListFooterProps {\n  count: number;\n  className?: string;\n  loading?: boolean;\n  loadMore?: () => void;\n  needReload?: boolean;\n  reload?: () => void;\n  ready?: boolean;\n  total?: number;\n}\n\nexport default function ListFooter(props: ListFooterProps) {\n  const { className, count, loading, needReload, total, ready = true } = props;\n  const hasMore = total && total > count;\n\n  let button;\n  if (needReload && props.reload) {\n    button = (\n      <Button className=\"spacer-left\" data-test=\"reload\" disabled={loading} onClick={props.reload}>\n        {translate('reload')}\n      </Button>\n    );\n  } else if (hasMore && props.loadMore) {\n    button = (\n      <Button\n        className=\"spacer-left\"\n        disabled={loading}\n        data-test=\"show-more\"\n        onClick={props.loadMore}>\n        {translate('show_more')}\n      </Button>\n    );\n  }\n\n  return (\n    <footer\n      className={classNames('spacer-top note text-center', { 'new-loading': !ready }, className)}>\n      {translateWithParameters(\n        'x_of_y_shown',\n        formatMeasure(count, 'INT', null),\n        formatMeasure(total, 'INT', null)\n      )}\n      {button}\n      {loading && <DeferredSpinner className=\"text-bottom spacer-left position-absolute\" />}\n    </footer>\n  );\n}\n","var baseDifference = require('./_baseDifference'),\n    baseRest = require('./_baseRest'),\n    isArrayLikeObject = require('./isArrayLikeObject');\n\n/**\n * Creates an array excluding all given values using\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons.\n *\n * **Note:** Unlike `_.pull`, this method returns a new array.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Array\n * @param {Array} array The array to inspect.\n * @param {...*} [values] The values to exclude.\n * @returns {Array} Returns the new array of filtered values.\n * @see _.difference, _.xor\n * @example\n *\n * _.without([2, 1, 2, 3], 1, 2);\n * // => [3]\n */\nvar without = baseRest(function(array, values) {\n  return isArrayLikeObject(array)\n    ? baseDifference(array, values)\n    : [];\n});\n\nmodule.exports = without;\n","var isArrayLike = require('./isArrayLike'),\n    isObjectLike = require('./isObjectLike');\n\n/**\n * This method is like `_.isArrayLike` except that it also checks if `value`\n * is an object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array-like object,\n *  else `false`.\n * @example\n *\n * _.isArrayLikeObject([1, 2, 3]);\n * // => true\n *\n * _.isArrayLikeObject(document.body.children);\n * // => true\n *\n * _.isArrayLikeObject('abc');\n * // => false\n *\n * _.isArrayLikeObject(_.noop);\n * // => false\n */\nfunction isArrayLikeObject(value) {\n  return isObjectLike(value) && isArrayLike(value);\n}\n\nmodule.exports = isArrayLikeObject;\n","var SetCache = require('./_SetCache'),\n    arrayIncludes = require('./_arrayIncludes'),\n    arrayIncludesWith = require('./_arrayIncludesWith'),\n    arrayMap = require('./_arrayMap'),\n    baseUnary = require('./_baseUnary'),\n    cacheHas = require('./_cacheHas');\n\n/** Used as the size to enable large array optimizations. */\nvar LARGE_ARRAY_SIZE = 200;\n\n/**\n * The base implementation of methods like `_.difference` without support\n * for excluding multiple arrays or iteratee shorthands.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {Array} values The values to exclude.\n * @param {Function} [iteratee] The iteratee invoked per element.\n * @param {Function} [comparator] The comparator invoked per element.\n * @returns {Array} Returns the new array of filtered values.\n */\nfunction baseDifference(array, values, iteratee, comparator) {\n  var index = -1,\n      includes = arrayIncludes,\n      isCommon = true,\n      length = array.length,\n      result = [],\n      valuesLength = values.length;\n\n  if (!length) {\n    return result;\n  }\n  if (iteratee) {\n    values = arrayMap(values, baseUnary(iteratee));\n  }\n  if (comparator) {\n    includes = arrayIncludesWith;\n    isCommon = false;\n  }\n  else if (values.length >= LARGE_ARRAY_SIZE) {\n    includes = cacheHas;\n    isCommon = false;\n    values = new SetCache(values);\n  }\n  outer:\n  while (++index < length) {\n    var value = array[index],\n        computed = iteratee == null ? value : iteratee(value);\n\n    value = (comparator || value !== 0) ? value : 0;\n    if (isCommon && computed === computed) {\n      var valuesIndex = valuesLength;\n      while (valuesIndex--) {\n        if (values[valuesIndex] === computed) {\n          continue outer;\n        }\n      }\n      result.push(value);\n    }\n    else if (!includes(values, computed, comparator)) {\n      result.push(value);\n    }\n  }\n  return result;\n}\n\nmodule.exports = baseDifference;\n","var createAggregator = require('./_createAggregator');\n\n/**\n * Creates an array of elements split into two groups, the first of which\n * contains elements `predicate` returns truthy for, the second of which\n * contains elements `predicate` returns falsey for. The predicate is\n * invoked with one argument: (value).\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Collection\n * @param {Array|Object} collection The collection to iterate over.\n * @param {Function} [predicate=_.identity] The function invoked per iteration.\n * @returns {Array} Returns the array of grouped elements.\n * @example\n *\n * var users = [\n *   { 'user': 'barney',  'age': 36, 'active': false },\n *   { 'user': 'fred',    'age': 40, 'active': true },\n *   { 'user': 'pebbles', 'age': 1,  'active': false }\n * ];\n *\n * _.partition(users, function(o) { return o.active; });\n * // => objects for [['fred'], ['barney', 'pebbles']]\n *\n * // The `_.matches` iteratee shorthand.\n * _.partition(users, { 'age': 1, 'active': false });\n * // => objects for [['pebbles'], ['barney', 'fred']]\n *\n * // The `_.matchesProperty` iteratee shorthand.\n * _.partition(users, ['active', false]);\n * // => objects for [['barney', 'pebbles'], ['fred']]\n *\n * // The `_.property` iteratee shorthand.\n * _.partition(users, 'active');\n * // => objects for [['fred'], ['barney', 'pebbles']]\n */\nvar partition = createAggregator(function(result, value, key) {\n  result[key ? 0 : 1].push(value);\n}, function() { return [[], []]; });\n\nmodule.exports = partition;\n"],"sourceRoot":""}