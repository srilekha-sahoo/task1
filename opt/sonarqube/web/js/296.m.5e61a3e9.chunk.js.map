{"version":3,"sources":["webpack:///./node_modules/lodash/noop.js","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/ComponentSourceSnippetGroupViewer.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/CrossComponentSourceViewerWrapper.tsx","webpack:///./src/main/js/components/icons/CopyIcon.tsx","webpack:///./src/main/js/components/controls/clipboard.tsx","webpack:///./src/main/js/components/icons/SettingsIcon.tsx","webpack:///./src/main/js/components/controls/ActionsDropdown.tsx","webpack:///./node_modules/lodash/toInteger.js","webpack:///./node_modules/lodash/_baseFindIndex.js","webpack:///./node_modules/lodash/findLastIndex.js","webpack:///./src/main/js/components/SourceViewer/helpers/indexing.ts","webpack:///./src/main/js/components/SourceViewer/helpers/highlight.ts","webpack:///./src/main/js/components/SourceViewer/helpers/issueLocations.ts","webpack:///./src/main/js/components/SourceViewer/SourceViewerContext.tsx","webpack:///./src/main/js/components/icons/ExpandSnippetIcon.tsx","webpack:///./src/main/js/components/SourceViewer/SourceViewerHeaderSlim.tsx","webpack:///./src/main/js/components/SourceViewer/SourceViewerHeaderSlim.css?94e1","webpack:///./src/main/js/components/SourceViewer/SourceViewerHeaderSlim.css","webpack:///./src/main/js/components/SourceViewer/components/Line.css?69c4","webpack:///./src/main/js/components/SourceViewer/components/Line.css","webpack:///./src/main/js/components/SourceViewer/helpers/lines.ts","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/utils.ts","webpack:///./src/main/js/components/SourceViewer/components/LineIssuesList.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineCode.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineCoverage.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineDuplicationBlock.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineIssuesIndicator.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineOptionsPopup.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineNumber.tsx","webpack:///./src/main/js/components/SourceViewer/components/SCMPopup.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineSCM.tsx","webpack:///./src/main/js/components/SourceViewer/components/Line.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css?ff37","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css","webpack:///./src/main/js/components/SourceViewer/components/DuplicationPopup.tsx","webpack:///./src/main/js/components/SourceViewer/helpers/duplications.ts"],"names":["module","exports","mounted","rootNodeRef","state","additionalLines","highlightedSymbols","loading","openIssuesByLine","snippets","expandBlock","snippetIndex","direction","branchLike","snippetGroup","this","props","key","component","snippet","find","s","index","Promise","reject","extension","range","from","Math","max","start","to","end","then","lines","reduce","lineMap","line","coverageStatus","getCoverageStatus","newLinesMapped","animateBlockExpansion","expandComponent","setState","length","handleOpenIssues","handleCloseIssues","handleSymbolClick","clickedSymbols","filter","symb","includes","loadDuplications","renderDuplicationPopup","createSnippetsFromProps","issue","locations","root","current","element","querySelector","wrapper","table","firstChild","nodes","getNodes","style","marginTop","maxHeight","value","up","undefined","getBoundingClientRect","height","startHeight","transition","setTimeout","newSnippets","deletedSnippets","toDelete","forEach","setMaxHeight","resolve","cleanDom","issuesByLine","lastSnippetOfLastGroup","locationsByLine","SnippetViewer","duplications","duplicationsByLine","highlightedLocationMessage","issuePopup","onIssueChange","onIssuePopupToggle","onLocationSelect","scroll","isLastOccurenceOfPrimaryComponent","lastSnippetGroup","textRange","fullyShown","measures","parseInt","snippetLines","sources","includeIssueLocation","secondaryLocations","className","ref","SourceViewerHeaderSlim","expandable","onExpand","sourceViewerFile","Issue","onChange","onClick","onPopupToggle","openPopup","name","selected","map","id","renderSnippet","components","notAccessible","fetchDuplications","r","duplicatedFiles","files","handleIssuePopupToggle","popupName","open","samePopup","blocks","Consumer","openComponent","DuplicationPopup","inRemovedComponent","fetchIssueFlowSnippets","newProps","issueKey","onLoaded","response","status","throwGlobalError","DeferredSpinner","Alert","variant","issuesByComponent","issues","locationsByComponent","lastOccurenceOfPrimaryComponent","i","SourceViewerContext","Provider","selectedFlowIndex","file","CopyIcon","fill","iconProps","Icon","fillRule","d","copySuccess","setCopyButton","node","copyButton","handleSuccessCopy","clipboard","on","destroy","children","ClipboardButton","copyValue","Tooltip","overlay","visible","innerRef","ClipboardIconButton","tooltip","tooltipProps","SettingsIcon","size","viewBox","transform","ActionsDropdown","overlayPlacement","small","toggleClassName","Dropdown","onOpen","DropdownIcon","handleClick","event","preventDefault","currentTarget","blur","destructive","download","href","ActionsDropdownDivider","toFinite","result","remainder","array","predicate","fromIndex","fromRight","baseFindIndex","baseIteratee","toInteger","nativeMax","nativeMin","min","endLine","push","issuesByComponentAndLine","mapping","location","duplicationIndex","block","_ref","symbolsByLine","tokens","code","symbols","token","keys","match","splitByTokens","rootClassName","container","document","createElement","innerHTML","call","childNodes","nodeType","fullClassName","innerTokens","concat","nodeValue","markers","text","highlightSymbol","symbol","symbolRegExp","RegExp","test","part","str","acc","substr","highlightIssueLocations","issueLocations","nextTokens","markerAdded","startLine","x","s1","e1","s2","e2","p1","p2","p3","newClassName","indexOf","slice","getLinearLocations","startOffset","endOffset","getSecondaryIssueLocationsForLine","highlightedLocations","l","msg","ExpandSnippetIcon","stroke","strokeWidth","displayProjectName","linkToProject","path","project","projectName","q","subProject","subProjectName","projectNameLabel","qualifier","Project","SubProject","resolved","api","content","__esModule","default","options","exported","locals","___CSS_LOADER_API_IMPORT___","optimizeHighlightedSymbols","symbolsForLine","optimizeLocationMessage","optimizedSecondaryIssueLocations","some","optimizeSelectedIssue","selectedIssue","issuesForLine","MERGE_DISTANCE","LINES_BELOW_ISSUE","EXPAND_BY_LINES","collision","startA","endA","startB","endB","getPrimaryLocation","createSnippets","params","hasSecondaryLocations","ranges","loc","startIndex","endIndex","locationEnd","issueEndLine","addLinesBellow","firstCollision","keep","sort","a","b","linesForSnippets","componentLines","groupLocationsByComponent","currentGroup","currentComponent","groups","addGroup","componentKey","uuid","every","expandSnippet","snippetToExpand","Error","inSnippet","LineIssuesList","displayLocationsCount","displayIssueLocationsCount","displayLocationsLink","displayIssueLocationsLink","onIssueClick","super","onSymbolClick","attachEvents","activeMarkerNode","nextProps","detachEvents","prevProps","codeNode","querySelectorAll","addEventListener","message","leading","LocationIndex","LocationMessage","onIssueSelect","padding","secondaryIssueLocations","showIssues","highlight","renderedTokens","leadingMarker","displayLocationMarkers","marker","renderMarker","trim","paddingBottom","filteredSelectedIssues","scrollToUncoveredLine","coverageMarker","conditions","coveredConditions","getStatusTooltip","placement","blocksLoaded","duplicated","dropdownOpen","setDropdownOpen","Toggler","onRequestClose","RightTop","role","tabIndex","issuesOpen","hasIssues","mostImportantIssue","tooltipContent","type","e","IssueIcon","firstLineNumber","codeLocation","codeUrl","isAtTop","noPadding","BottomLeft","TopLeft","displayOptions","isOpen","setOpen","lineNumber","closeOnClickOutside","hasAuthor","scmAuthor","hasDate","scmDate","DateFormatter","date","scmRevision","previousLine","hasPopup","cell","p","changed","isSCMChanged","ariaLabel","handleIssuesIndicatorClick","openIssues","onIssuesClose","onIssueUnselect","onIssuesOpen","displayAllIssues","displayCoverage","displayDuplications","displayLineNumberOptions","displayIssues","displaySCM","duplicationsCount","highlighted","last","verticalBuffer","isNew","bottomPadding","Boolean","doScroll","parent","snippetNodeRef","offset","width","leftOffset","rightOffset","scrollToLastExpandedRow","snippetNode","rows","lastRow","lineDuplications","isSinkLine","noop","lastLine","bottomLine","issueLine","lowestVisibleIssue","Object","k","renderLine","isDifferentComponent","handleFileClick","dataset","shouldLink","Number","title","groupedBlocks","fileRef","duplication","renderDuplication","filterDuplicationBlocksByLine","foundOne","outOfBounds","shouldDisplay","isOk","getDuplicationBlocksForIndex","isDuplicationBlockInRemovedComponent"],"mappings":"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","file":"js/296.m.5e61a3e9.chunk.js","sourcesContent":["/**\n * This method returns `undefined`.\n *\n * @static\n * @memberOf _\n * @since 2.3.0\n * @category Util\n * @example\n *\n * _.times(2, _.noop);\n * // => [undefined, undefined]\n */\nfunction noop() {\n  // No operation performed.\n}\n\nmodule.exports = noop;\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { noop } from 'lodash';\nimport * as React from 'react';\nimport { getSources } from '../../../api/components';\nimport Issue from '../../../components/issue/Issue';\nimport getCoverageStatus from '../../../components/SourceViewer/helpers/getCoverageStatus';\nimport { locationsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport SourceViewerHeaderSlim from '../../../components/SourceViewer/SourceViewerHeaderSlim';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { BranchLike } from '../../../types/branch-like';\nimport SnippetViewer from './SnippetViewer';\nimport {\n  createSnippets,\n  expandSnippet,\n  EXPAND_BY_LINES,\n  linesForSnippets,\n  MERGE_DISTANCE\n} from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  isLastOccurenceOfPrimaryComponent: boolean;\n  issue: T.Issue;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  lastSnippetGroup: boolean;\n  loadDuplications: (component: string, line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLocationSelect: (index: number) => void;\n  renderDuplicationPopup: (\n    component: T.SourceViewerFile,\n    index: number,\n    line: number\n  ) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset: number) => void;\n  snippetGroup: T.SnippetGroup;\n}\n\ninterface State {\n  additionalLines: { [line: number]: T.SourceLine };\n  highlightedSymbols: string[];\n  loading: boolean;\n  openIssuesByLine: T.Dict<boolean>;\n  snippets: T.Snippet[];\n}\n\nexport default class ComponentSourceSnippetGroupViewer extends React.PureComponent<Props, State> {\n  mounted = false;\n  rootNodeRef = React.createRef<HTMLDivElement>();\n  state: State = {\n    additionalLines: {},\n    highlightedSymbols: [],\n    loading: false,\n    openIssuesByLine: {},\n    snippets: []\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.createSnippetsFromProps();\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  createSnippetsFromProps() {\n    const { issue, snippetGroup } = this.props;\n\n    const snippets = createSnippets({\n      component: snippetGroup.component.key,\n      issue,\n      locations: snippetGroup.locations\n    });\n\n    this.setState({ snippets });\n  }\n\n  getNodes(index: number): { wrapper: HTMLElement; table: HTMLElement } | undefined {\n    const root = this.rootNodeRef.current;\n    if (!root) {\n      return undefined;\n    }\n    const element = root.querySelector(`#snippet-wrapper-${index}`);\n    if (!element) {\n      return undefined;\n    }\n    const wrapper = element.querySelector<HTMLElement>('.snippet');\n    if (!wrapper) {\n      return undefined;\n    }\n    const table = wrapper.firstChild as HTMLElement;\n    if (!table) {\n      return undefined;\n    }\n\n    return { wrapper, table };\n  }\n\n  /*\n   * Clean after animation\n   */\n  cleanDom(index: number) {\n    const nodes = this.getNodes(index);\n\n    if (!nodes) {\n      return;\n    }\n\n    const { wrapper, table } = nodes;\n\n    table.style.marginTop = '';\n    wrapper.style.maxHeight = '';\n  }\n\n  setMaxHeight(index: number, value?: number, up = false) {\n    const nodes = this.getNodes(index);\n\n    if (!nodes) {\n      return;\n    }\n\n    const { wrapper, table } = nodes;\n\n    const maxHeight = value !== undefined ? value : table.getBoundingClientRect().height;\n\n    if (up) {\n      const startHeight = wrapper.getBoundingClientRect().height;\n      table.style.transition = 'none';\n      table.style.marginTop = `${startHeight - maxHeight}px`;\n\n      // animate!\n      setTimeout(() => {\n        table.style.transition = '';\n        table.style.marginTop = '0px';\n        wrapper.style.maxHeight = `${maxHeight + 20}px`;\n      }, 0);\n    } else {\n      wrapper.style.maxHeight = `${maxHeight + 20}px`;\n    }\n  }\n\n  expandBlock = (snippetIndex: number, direction: T.ExpandDirection): Promise<void> => {\n    const { branchLike, snippetGroup } = this.props;\n    const { key } = snippetGroup.component;\n    const { snippets } = this.state;\n    const snippet = snippets.find(s => s.index === snippetIndex);\n    if (!snippet) {\n      return Promise.reject();\n    }\n    // Extend by EXPAND_BY_LINES and add buffer for merging snippets\n    const extension = EXPAND_BY_LINES + MERGE_DISTANCE - 1;\n    const range =\n      direction === 'up'\n        ? {\n            from: Math.max(1, snippet.start - extension),\n            to: snippet.start - 1\n          }\n        : {\n            from: snippet.end + 1,\n            to: snippet.end + extension\n          };\n    return getSources({\n      key,\n      ...range,\n      ...getBranchLikeQuery(branchLike)\n    })\n      .then(lines =>\n        lines.reduce((lineMap: T.Dict<T.SourceLine>, line) => {\n          line.coverageStatus = getCoverageStatus(line);\n          lineMap[line.line] = line;\n          return lineMap;\n        }, {})\n      )\n      .then(newLinesMapped => this.animateBlockExpansion(snippetIndex, direction, newLinesMapped));\n  };\n\n  animateBlockExpansion(\n    snippetIndex: number,\n    direction: T.ExpandDirection,\n    newLinesMapped: T.Dict<T.SourceLine>\n  ): Promise<void> {\n    if (this.mounted) {\n      const { snippets } = this.state;\n\n      const newSnippets = expandSnippet({\n        direction,\n        snippetIndex,\n        snippets\n      });\n\n      const deletedSnippets = newSnippets.filter(s => s.toDelete);\n\n      // set max-height to current height for CSS transitions\n      deletedSnippets.forEach(s => this.setMaxHeight(s.index));\n      this.setMaxHeight(snippetIndex);\n\n      return new Promise(resolve => {\n        this.setState(\n          ({ additionalLines, snippets }) => {\n            const combinedLines = { ...additionalLines, ...newLinesMapped };\n            return {\n              additionalLines: combinedLines,\n              snippets\n            };\n          },\n          () => {\n            // Set max-height 0 to trigger CSS transitions\n            deletedSnippets.forEach(s => {\n              this.setMaxHeight(s.index, 0);\n            });\n            this.setMaxHeight(snippetIndex, undefined, direction === 'up');\n\n            // Wait for transition to finish before updating dom\n            setTimeout(() => {\n              this.setState({ snippets: newSnippets.filter(s => !s.toDelete) }, resolve);\n              this.cleanDom(snippetIndex);\n            }, 200);\n          }\n        );\n      });\n    }\n    return Promise.resolve();\n  }\n\n  expandComponent = () => {\n    const { branchLike, snippetGroup } = this.props;\n    const { key } = snippetGroup.component;\n\n    this.setState({ loading: true });\n\n    getSources({ key, ...getBranchLikeQuery(branchLike) }).then(\n      lines => {\n        if (this.mounted) {\n          this.setState(({ additionalLines }) => {\n            const combinedLines = { ...additionalLines, ...lines };\n            return {\n              additionalLines: combinedLines,\n              loading: false,\n              snippets: [{ start: 0, end: lines[lines.length - 1].line, index: -1 }]\n            };\n          });\n        }\n      },\n      () => {\n        if (this.mounted) {\n          this.setState({ loading: false });\n        }\n      }\n    );\n  };\n\n  handleOpenIssues = (line: T.SourceLine) => {\n    this.setState(state => ({\n      openIssuesByLine: { ...state.openIssuesByLine, [line.line]: true }\n    }));\n  };\n\n  handleCloseIssues = (line: T.SourceLine) => {\n    this.setState(state => ({\n      openIssuesByLine: { ...state.openIssuesByLine, [line.line]: false }\n    }));\n  };\n\n  handleSymbolClick = (clickedSymbols: string[]) => {\n    this.setState(({ highlightedSymbols }) => {\n      const newHighlightedSymbols = clickedSymbols.filter(\n        symb => !highlightedSymbols.includes(symb)\n      );\n      return { highlightedSymbols: newHighlightedSymbols };\n    });\n  };\n\n  loadDuplications = (line: T.SourceLine) => {\n    this.props.loadDuplications(this.props.snippetGroup.component.key, line);\n  };\n\n  renderDuplicationPopup = (index: number, line: number) => {\n    return this.props.renderDuplicationPopup(this.props.snippetGroup.component, index, line);\n  };\n\n  renderSnippet({\n    index,\n    issuesByLine,\n    lastSnippetOfLastGroup,\n    locationsByLine,\n    snippet\n  }: {\n    index: number;\n    issuesByLine: T.IssuesByLine;\n    lastSnippetOfLastGroup: boolean;\n    locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n    snippet: T.SourceLine[];\n  }) {\n    return (\n      <SnippetViewer\n        branchLike={this.props.branchLike}\n        component={this.props.snippetGroup.component}\n        duplications={this.props.duplications}\n        duplicationsByLine={this.props.duplicationsByLine}\n        expandBlock={this.expandBlock}\n        handleCloseIssues={this.handleCloseIssues}\n        handleOpenIssues={this.handleOpenIssues}\n        handleSymbolClick={this.handleSymbolClick}\n        highlightedLocationMessage={this.props.highlightedLocationMessage}\n        highlightedSymbols={this.state.highlightedSymbols}\n        index={index}\n        issue={this.props.issue}\n        issuePopup={this.props.issuePopup}\n        issuesByLine={issuesByLine}\n        lastSnippetOfLastGroup={lastSnippetOfLastGroup}\n        loadDuplications={this.loadDuplications}\n        locations={this.props.locations}\n        locationsByLine={locationsByLine}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onLocationSelect={this.props.onLocationSelect}\n        openIssuesByLine={this.state.openIssuesByLine}\n        renderDuplicationPopup={this.renderDuplicationPopup}\n        scroll={this.props.scroll}\n        snippet={snippet}\n      />\n    );\n  }\n\n  render() {\n    const {\n      branchLike,\n      isLastOccurenceOfPrimaryComponent,\n      issue,\n      issuesByLine,\n      issuePopup,\n      lastSnippetGroup,\n      snippetGroup\n    } = this.props;\n    const { additionalLines, loading, snippets } = this.state;\n    const locations =\n      issue.component === snippetGroup.component.key && issue.textRange !== undefined\n        ? locationsByLine([issue])\n        : {};\n\n    const fullyShown =\n      snippets.length === 1 &&\n      snippetGroup.component.measures &&\n      snippets[0].end - snippets[0].start ===\n        parseInt(snippetGroup.component.measures.lines || '', 10);\n\n    const snippetLines = linesForSnippets(snippets, {\n      ...snippetGroup.sources,\n      ...additionalLines\n    });\n\n    const isFlow = issue.secondaryLocations.length === 0;\n    const includeIssueLocation = isFlow ? isLastOccurenceOfPrimaryComponent : true;\n\n    return (\n      <div className=\"component-source-container\" ref={this.rootNodeRef}>\n        <SourceViewerHeaderSlim\n          branchLike={branchLike}\n          expandable={!fullyShown}\n          loading={loading}\n          onExpand={this.expandComponent}\n          sourceViewerFile={snippetGroup.component}\n        />\n        {issue.component === snippetGroup.component.key && issue.textRange === undefined && (\n          <div className=\"padded-top padded-left padded-right\">\n            <Issue\n              issue={issue}\n              onChange={this.props.onIssueChange}\n              onClick={noop}\n              onPopupToggle={this.props.onIssuePopupToggle}\n              openPopup={issuePopup && issuePopup.issue === issue.key ? issuePopup.name : undefined}\n              selected={true}\n            />\n          </div>\n        )}\n        {snippetLines.map((snippet, index) => (\n          <div id={`snippet-wrapper-${snippets[index].index}`} key={snippets[index].index}>\n            {this.renderSnippet({\n              snippet,\n              index: snippets[index].index,\n              issuesByLine,\n              locationsByLine: includeIssueLocation ? locations : {},\n              lastSnippetOfLastGroup: lastSnippetGroup && index === snippets.length - 1\n            })}\n          </div>\n        ))}\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { findLastIndex } from 'lodash';\nimport * as React from 'react';\nimport { getDuplications } from '../../../api/components';\nimport { getIssueFlowSnippets } from '../../../api/issues';\nimport throwGlobalError from '../../../app/utils/throwGlobalError';\nimport DuplicationPopup from '../../../components/SourceViewer/components/DuplicationPopup';\nimport {\n  filterDuplicationBlocksByLine,\n  getDuplicationBlocksForIndex,\n  isDuplicationBlockInRemovedComponent\n} from '../../../components/SourceViewer/helpers/duplications';\nimport {\n  duplicationsByLine as getDuplicationsByLine,\n  issuesByComponentAndLine\n} from '../../../components/SourceViewer/helpers/indexing';\nimport { SourceViewerContext } from '../../../components/SourceViewer/SourceViewerContext';\nimport { Alert } from '../../../components/ui/Alert';\nimport DeferredSpinner from '../../../components/ui/DeferredSpinner';\nimport { WorkspaceContext } from '../../../components/workspace/context';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { translate } from '../../../helpers/l10n';\nimport { BranchLike } from '../../../types/branch-like';\nimport ComponentSourceSnippetGroupViewer from './ComponentSourceSnippetGroupViewer';\nimport { groupLocationsByComponent } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  highlightedLocationMessage?: { index: number; text: string | undefined };\n  issue: T.Issue;\n  issues: T.Issue[];\n  locations: T.FlowLocation[];\n  onIssueChange: (issue: T.Issue) => void;\n  onLoaded?: () => void;\n  onLocationSelect: (index: number) => void;\n  scroll?: (element: HTMLElement) => void;\n  selectedFlowIndex: number | undefined;\n}\n\ninterface State {\n  components: T.Dict<T.SnippetsByComponent>;\n  duplicatedFiles?: T.Dict<T.DuplicatedFile>;\n  duplications?: T.Duplication[];\n  duplicationsByLine: { [line: number]: number[] };\n  issuePopup?: { issue: string; name: string };\n  loading: boolean;\n  notAccessible: boolean;\n}\n\nexport default class CrossComponentSourceViewerWrapper extends React.PureComponent<Props, State> {\n  mounted = false;\n  state: State = {\n    components: {},\n    duplicationsByLine: {},\n    loading: true,\n    notAccessible: false\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.fetchIssueFlowSnippets(this.props.issue.key);\n  }\n\n  componentWillReceiveProps(newProps: Props) {\n    if (newProps.issue.key !== this.props.issue.key) {\n      this.fetchIssueFlowSnippets(newProps.issue.key);\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  fetchDuplications = (component: string) => {\n    getDuplications({\n      key: component,\n      ...getBranchLikeQuery(this.props.branchLike)\n    }).then(\n      r => {\n        if (this.mounted) {\n          this.setState({\n            duplicatedFiles: r.files,\n            duplications: r.duplications,\n            duplicationsByLine: getDuplicationsByLine(r.duplications)\n          });\n        }\n      },\n      () => {}\n    );\n  };\n\n  fetchIssueFlowSnippets(issueKey: string) {\n    this.setState({ loading: true });\n    getIssueFlowSnippets(issueKey).then(\n      components => {\n        if (this.mounted) {\n          this.setState({\n            components,\n            issuePopup: undefined,\n            loading: false\n          });\n          if (this.props.onLoaded) {\n            this.props.onLoaded();\n          }\n        }\n      },\n      (response: Response) => {\n        if (response.status !== 403) {\n          throwGlobalError(response);\n        }\n        if (this.mounted) {\n          this.setState({ loading: false, notAccessible: response.status === 403 });\n        }\n      }\n    );\n  }\n\n  handleIssuePopupToggle = (issue: string, popupName: string, open?: boolean) => {\n    this.setState((state: State) => {\n      const samePopup =\n        state.issuePopup && state.issuePopup.name === popupName && state.issuePopup.issue === issue;\n      if (open !== false && !samePopup) {\n        return { issuePopup: { issue, name: popupName } };\n      } else if (open !== true && samePopup) {\n        return { issuePopup: undefined };\n      }\n      return null;\n    });\n  };\n\n  renderDuplicationPopup = (component: T.SourceViewerFile, index: number, line: number) => {\n    const { duplicatedFiles, duplications } = this.state;\n\n    if (!component || !duplicatedFiles) {\n      return null;\n    }\n\n    const blocks = getDuplicationBlocksForIndex(duplications, index);\n\n    return (\n      <WorkspaceContext.Consumer>\n        {({ openComponent }) => (\n          <DuplicationPopup\n            blocks={filterDuplicationBlocksByLine(blocks, line)}\n            branchLike={this.props.branchLike}\n            duplicatedFiles={duplicatedFiles}\n            inRemovedComponent={isDuplicationBlockInRemovedComponent(blocks)}\n            openComponent={openComponent}\n            sourceViewerFile={component}\n          />\n        )}\n      </WorkspaceContext.Consumer>\n    );\n  };\n\n  render() {\n    const { loading, notAccessible } = this.state;\n\n    if (loading) {\n      return (\n        <div>\n          <DeferredSpinner />\n        </div>\n      );\n    }\n\n    if (notAccessible) {\n      return (\n        <Alert className=\"spacer-top\" variant=\"warning\">\n          {translate('code_viewer.no_source_code_displayed_due_to_security')}\n        </Alert>\n      );\n    }\n\n    const { issue, locations } = this.props;\n    const { components, duplications, duplicationsByLine } = this.state;\n    const issuesByComponent = issuesByComponentAndLine(this.props.issues);\n    const locationsByComponent = groupLocationsByComponent(issue, locations, components);\n\n    const lastOccurenceOfPrimaryComponent = findLastIndex(\n      locationsByComponent,\n      ({ component }) => component.key === issue.component\n    );\n\n    return (\n      <div>\n        {locationsByComponent.map((snippetGroup, i) => {\n          return (\n            <SourceViewerContext.Provider\n              // eslint-disable-next-line react/no-array-index-key\n              key={`${issue.key}-${this.props.selectedFlowIndex || 0}-${i}`}\n              value={{ branchLike: this.props.branchLike, file: snippetGroup.component }}>\n              <ComponentSourceSnippetGroupViewer\n                branchLike={this.props.branchLike}\n                duplications={duplications}\n                duplicationsByLine={duplicationsByLine}\n                highlightedLocationMessage={this.props.highlightedLocationMessage}\n                issue={issue}\n                issuePopup={this.state.issuePopup}\n                issuesByLine={issuesByComponent[snippetGroup.component.key] || {}}\n                isLastOccurenceOfPrimaryComponent={i === lastOccurenceOfPrimaryComponent}\n                lastSnippetGroup={i === locationsByComponent.length - 1}\n                loadDuplications={this.fetchDuplications}\n                locations={snippetGroup.locations || []}\n                onIssueChange={this.props.onIssueChange}\n                onIssuePopupToggle={this.handleIssuePopupToggle}\n                onLocationSelect={this.props.onLocationSelect}\n                renderDuplicationPopup={this.renderDuplicationPopup}\n                scroll={this.props.scroll}\n                snippetGroup={snippetGroup}\n              />\n            </SourceViewerContext.Provider>\n          );\n        })}\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport Icon, { IconProps } from './Icon';\n\nexport default function CopyIcon({ fill = 'currentColor', ...iconProps }: IconProps) {\n  return (\n    <Icon {...iconProps}>\n      <g fill={fill} fillRule=\"nonzero\">\n        <path d=\"M2.931 15.005V3H2v13h9v-.995z\" />\n        <path d=\"M10 4.015h3V14H4V1h6v3.015zM9 8V6H8v2H6v1h2v2h1V9h2V8H9z\" />\n        <path d=\"M11 1v2h2a2.151 2.151 0 0 0-2-2z\" />\n      </g>\n    </Icon>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as Clipboard from 'clipboard';\nimport * as React from 'react';\nimport { translate } from '../../helpers/l10n';\nimport CopyIcon from '../icons/CopyIcon';\nimport { Button, ButtonIcon } from './buttons';\nimport Tooltip from './Tooltip';\n\nexport interface State {\n  copySuccess: boolean;\n}\n\ninterface RenderProps {\n  setCopyButton: (node: HTMLElement | null) => void;\n  copySuccess: boolean;\n}\n\ninterface BaseProps {\n  children: (props: RenderProps) => React.ReactNode;\n}\n\nexport class ClipboardBase extends React.PureComponent<BaseProps, State> {\n  private clipboard?: Clipboard;\n  private copyButton?: HTMLElement | null;\n  mounted = false;\n  state: State = { copySuccess: false };\n\n  componentDidMount() {\n    this.mounted = true;\n    if (this.copyButton) {\n      this.clipboard = new Clipboard(this.copyButton);\n      this.clipboard.on('success', this.handleSuccessCopy);\n    }\n  }\n\n  componentDidUpdate() {\n    if (this.clipboard) {\n      this.clipboard.destroy();\n    }\n    if (this.copyButton) {\n      this.clipboard = new Clipboard(this.copyButton);\n      this.clipboard.on('success', this.handleSuccessCopy);\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n    if (this.clipboard) {\n      this.clipboard.destroy();\n    }\n  }\n\n  setCopyButton = (node: HTMLElement | null) => {\n    this.copyButton = node;\n  };\n\n  handleSuccessCopy = () => {\n    if (this.mounted) {\n      this.setState({ copySuccess: true });\n      setTimeout(() => {\n        if (this.mounted) {\n          this.setState({ copySuccess: false });\n        }\n      }, 1000);\n    }\n  };\n\n  render() {\n    return this.props.children({\n      setCopyButton: this.setCopyButton,\n      copySuccess: this.state.copySuccess\n    });\n  }\n}\n\ninterface ButtonProps {\n  className?: string;\n  copyValue: string;\n  children?: React.ReactNode;\n}\n\nexport function ClipboardButton({ className, children, copyValue }: ButtonProps) {\n  return (\n    <ClipboardBase>\n      {({ setCopyButton, copySuccess }) => (\n        <Tooltip overlay={translate('copied_action')} visible={copySuccess}>\n          <Button\n            className={classNames('no-select', className)}\n            data-clipboard-text={copyValue}\n            innerRef={setCopyButton}>\n            {children || (\n              <>\n                <CopyIcon className=\"little-spacer-right\" />\n                {translate('copy')}\n              </>\n            )}\n          </Button>\n        </Tooltip>\n      )}\n    </ClipboardBase>\n  );\n}\n\ninterface IconButtonProps {\n  'aria-label'?: string;\n  className?: string;\n  copyValue: string;\n}\n\nexport function ClipboardIconButton(props: IconButtonProps) {\n  const { className, copyValue } = props;\n  return (\n    <ClipboardBase>\n      {({ setCopyButton, copySuccess }) => {\n        return (\n          <ButtonIcon\n            aria-label={props['aria-label'] ?? translate('copy_to_clipboard')}\n            className={classNames('no-select', className)}\n            data-clipboard-text={copyValue}\n            innerRef={setCopyButton}\n            tooltip={translate(copySuccess ? 'copied_action' : 'copy_to_clipboard')}\n            tooltipProps={copySuccess ? { visible: copySuccess } : undefined}>\n            <CopyIcon />\n          </ButtonIcon>\n        );\n      }}\n    </ClipboardBase>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport Icon, { IconProps } from './Icon';\n\nexport default function SettingsIcon({\n  fill = 'currentColor',\n  size = 14,\n  ...iconProps\n}: IconProps) {\n  return (\n    <Icon size={size} viewBox=\"0 0 14 14\" {...iconProps}>\n      <g transform=\"matrix(0.0364583,0,0,0.0364583,0,-1.16667)\">\n        <path\n          d=\"M256,224C256,206.333 249.75,191.25 237.25,178.75C224.75,166.25 209.667,160 192,160C174.333,160 159.25,166.25 146.75,178.75C134.25,191.25 128,206.333 128,224C128,241.667 134.25,256.75 146.75,269.25C159.25,281.75 174.333,288 192,288C209.667,288 224.75,281.75 237.25,269.25C249.75,256.75 256,241.667 256,224ZM384,196.75L384,252.25C384,254.25 383.333,256.167 382,258C380.667,259.833 379,260.917 377,261.25L330.75,268.25C327.583,277.25 324.333,284.833 321,291C326.833,299.333 335.75,310.833 347.75,325.5C349.417,327.5 350.25,329.583 350.25,331.75C350.25,333.917 349.5,335.833 348,337.5C343.5,343.667 335.25,352.667 323.25,364.5C311.25,376.333 303.417,382.25 299.75,382.25C297.75,382.25 295.583,381.5 293.25,380L258.75,353C251.417,356.833 243.833,360 236,362.5C233.333,385.167 230.917,400.667 228.75,409C227.583,413.667 224.583,416 219.75,416L164.25,416C161.917,416 159.875,415.292 158.125,413.875C156.375,412.458 155.417,410.667 155.25,408.5L148.25,362.5C140.083,359.833 132.583,356.75 125.75,353.25L90.5,380C88.833,381.5 86.75,382.25 84.25,382.25C81.917,382.25 79.833,381.333 78,379.5C57,360.5 43.25,346.5 36.75,337.5C35.583,335.833 35,333.917 35,331.75C35,329.75 35.667,327.833 37,326C39.5,322.5 43.75,316.958 49.75,309.375C55.75,301.792 60.25,295.917 63.25,291.75C58.75,283.417 55.333,275.167 53,267L7.25,260.25C5.083,259.917 3.333,258.875 2,257.125C0.667,255.375 0,253.417 0,251.25L0,195.75C0,193.75 0.667,191.833 2,190C3.333,188.167 4.917,187.083 6.75,186.75L53.25,179.75C55.583,172.083 58.833,164.417 63,156.75C56.333,147.25 47.417,135.75 36.25,122.25C34.583,120.25 33.75,118.25 33.75,116.25C33.75,114.583 34.5,112.667 36,110.5C40.333,104.5 48.542,95.542 60.625,83.625C72.708,71.708 80.583,65.75 84.25,65.75C86.417,65.75 88.583,66.583 90.75,68.25L125.25,95C132.583,91.167 140.167,88 148,85.5C150.667,62.833 153.083,47.333 155.25,39C156.417,34.333 159.417,32 164.25,32L219.75,32C222.083,32 224.125,32.708 225.875,34.125C227.625,35.542 228.583,37.333 228.75,39.5L235.75,85.5C243.917,88.167 251.417,91.25 258.25,94.75L293.75,68C295.25,66.5 297.25,65.75 299.75,65.75C301.917,65.75 304,66.583 306,68.25C327.5,88.083 341.25,102.25 347.25,110.75C348.417,112.083 349,113.917 349,116.25C349,118.25 348.333,120.167 347,122C344.5,125.5 340.25,131.042 334.25,138.625C328.25,146.208 323.75,152.083 320.75,156.25C325.083,164.583 328.5,172.75 331,180.75L376.75,187.75C378.917,188.083 380.667,189.125 382,190.875C383.333,192.625 384,194.583 384,196.75Z\"\n          style={{ fill }}\n        />\n      </g>\n    </Icon>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport { LocationDescriptor } from 'history';\nimport * as React from 'react';\nimport { Link } from 'react-router';\nimport { translate } from '../../helpers/l10n';\nimport DropdownIcon from '../icons/DropdownIcon';\nimport SettingsIcon from '../icons/SettingsIcon';\nimport { PopupPlacement } from '../ui/popups';\nimport { Button } from './buttons';\nimport { ClipboardBase } from './clipboard';\nimport Dropdown from './Dropdown';\nimport Tooltip from './Tooltip';\n\nexport interface ActionsDropdownProps {\n  className?: string;\n  children: React.ReactNode;\n  onOpen?: () => void;\n  overlayPlacement?: PopupPlacement;\n  small?: boolean;\n  toggleClassName?: string;\n}\n\nexport default function ActionsDropdown(props: ActionsDropdownProps) {\n  const { children, className, overlayPlacement, small, toggleClassName } = props;\n  return (\n    <Dropdown\n      className={className}\n      onOpen={props.onOpen}\n      overlay={<ul className=\"menu\">{children}</ul>}\n      overlayPlacement={overlayPlacement}>\n      <Button\n        className={classNames('dropdown-toggle', toggleClassName, {\n          'button-small': small\n        })}>\n        <SettingsIcon size={small ? 12 : 14} />\n        <DropdownIcon className=\"little-spacer-left\" />\n      </Button>\n    </Dropdown>\n  );\n}\n\ninterface ItemProps {\n  className?: string;\n  children: React.ReactNode;\n  /** used to pass a string to copy to clipboard */\n  copyValue?: string;\n  destructive?: boolean;\n  /** used to pass a name of downloaded file */\n  download?: string;\n  id?: string;\n  onClick?: () => void;\n  to?: LocationDescriptor;\n}\n\nexport class ActionsDropdownItem extends React.PureComponent<ItemProps> {\n  handleClick = (event: React.SyntheticEvent<HTMLAnchorElement>) => {\n    event.preventDefault();\n    event.currentTarget.blur();\n    if (this.props.onClick) {\n      this.props.onClick();\n    }\n  };\n\n  render() {\n    const className = classNames(this.props.className, { 'text-danger': this.props.destructive });\n\n    if (this.props.download && typeof this.props.to === 'string') {\n      return (\n        <li>\n          <a\n            className={className}\n            download={this.props.download}\n            href={this.props.to}\n            id={this.props.id}>\n            {this.props.children}\n          </a>\n        </li>\n      );\n    }\n\n    if (this.props.to) {\n      return (\n        <li>\n          <Link className={className} id={this.props.id} to={this.props.to}>\n            {this.props.children}\n          </Link>\n        </li>\n      );\n    }\n\n    if (this.props.copyValue) {\n      return (\n        <ClipboardBase>\n          {({ setCopyButton, copySuccess }) => (\n            <Tooltip overlay={translate('copied_action')} visible={copySuccess}>\n              <li data-clipboard-text={this.props.copyValue} ref={setCopyButton}>\n                <a className={className} href=\"#\" id={this.props.id} onClick={this.handleClick}>\n                  {this.props.children}\n                </a>\n              </li>\n            </Tooltip>\n          )}\n        </ClipboardBase>\n      );\n    }\n\n    return (\n      <li>\n        <a className={className} href=\"#\" id={this.props.id} onClick={this.handleClick}>\n          {this.props.children}\n        </a>\n      </li>\n    );\n  }\n}\n\nexport function ActionsDropdownDivider() {\n  return <li className=\"divider\" />;\n}\n","var toFinite = require('./toFinite');\n\n/**\n * Converts `value` to an integer.\n *\n * **Note:** This method is loosely based on\n * [`ToInteger`](http://www.ecma-international.org/ecma-262/7.0/#sec-tointeger).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {number} Returns the converted integer.\n * @example\n *\n * _.toInteger(3.2);\n * // => 3\n *\n * _.toInteger(Number.MIN_VALUE);\n * // => 0\n *\n * _.toInteger(Infinity);\n * // => 1.7976931348623157e+308\n *\n * _.toInteger('3.2');\n * // => 3\n */\nfunction toInteger(value) {\n  var result = toFinite(value),\n      remainder = result % 1;\n\n  return result === result ? (remainder ? result - remainder : result) : 0;\n}\n\nmodule.exports = toInteger;\n","/**\n * The base implementation of `_.findIndex` and `_.findLastIndex` without\n * support for iteratee shorthands.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {Function} predicate The function invoked per iteration.\n * @param {number} fromIndex The index to search from.\n * @param {boolean} [fromRight] Specify iterating from right to left.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction baseFindIndex(array, predicate, fromIndex, fromRight) {\n  var length = array.length,\n      index = fromIndex + (fromRight ? 1 : -1);\n\n  while ((fromRight ? index-- : ++index < length)) {\n    if (predicate(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n}\n\nmodule.exports = baseFindIndex;\n","var baseFindIndex = require('./_baseFindIndex'),\n    baseIteratee = require('./_baseIteratee'),\n    toInteger = require('./toInteger');\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * This method is like `_.findIndex` except that it iterates over elements\n * of `collection` from right to left.\n *\n * @static\n * @memberOf _\n * @since 2.0.0\n * @category Array\n * @param {Array} array The array to inspect.\n * @param {Function} [predicate=_.identity] The function invoked per iteration.\n * @param {number} [fromIndex=array.length-1] The index to search from.\n * @returns {number} Returns the index of the found element, else `-1`.\n * @example\n *\n * var users = [\n *   { 'user': 'barney',  'active': true },\n *   { 'user': 'fred',    'active': false },\n *   { 'user': 'pebbles', 'active': false }\n * ];\n *\n * _.findLastIndex(users, function(o) { return o.user == 'pebbles'; });\n * // => 2\n *\n * // The `_.matches` iteratee shorthand.\n * _.findLastIndex(users, { 'user': 'barney', 'active': true });\n * // => 0\n *\n * // The `_.matchesProperty` iteratee shorthand.\n * _.findLastIndex(users, ['active', false]);\n * // => 2\n *\n * // The `_.property` iteratee shorthand.\n * _.findLastIndex(users, 'active');\n * // => 0\n */\nfunction findLastIndex(array, predicate, fromIndex) {\n  var length = array == null ? 0 : array.length;\n  if (!length) {\n    return -1;\n  }\n  var index = length - 1;\n  if (fromIndex !== undefined) {\n    index = toInteger(fromIndex);\n    index = fromIndex < 0\n      ? nativeMax(length + index, 0)\n      : nativeMin(index, length - 1);\n  }\n  return baseFindIndex(array, baseIteratee(predicate, 3), index, true);\n}\n\nmodule.exports = findLastIndex;\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { flatten } from 'lodash';\nimport { splitByTokens } from './highlight';\nimport { getLinearLocations } from './issueLocations';\n\nexport function issuesByLine(issues: T.Issue[]) {\n  const index: { [line: number]: T.Issue[] } = {};\n  issues.forEach(issue => {\n    const line = issue.textRange ? issue.textRange.endLine : 0;\n    if (!(line in index)) {\n      index[line] = [];\n    }\n    index[line].push(issue);\n  });\n  return index;\n}\n\nexport function issuesByComponentAndLine(\n  issues: T.Issue[] = []\n): { [component: string]: { [line: number]: T.Issue[] } } {\n  return issues.reduce((mapping: { [component: string]: { [line: number]: T.Issue[] } }, issue) => {\n    mapping[issue.component] = mapping[issue.component] || {};\n    const line = issue.textRange ? issue.textRange.endLine : 0;\n    mapping[issue.component][line] = mapping[issue.component][line] || [];\n    mapping[issue.component][line].push(issue);\n    return mapping;\n  }, {});\n}\n\nexport function locationsByLine(issues: Pick<T.Issue, 'textRange'>[]) {\n  const index: { [line: number]: T.LinearIssueLocation[] } = {};\n  issues.forEach(issue => {\n    getLinearLocations(issue.textRange).forEach(location => {\n      if (!(location.line in index)) {\n        index[location.line] = [];\n      }\n      index[location.line].push(location);\n    });\n  });\n  return index;\n}\n\nexport function duplicationsByLine(duplications: T.Duplication[] | undefined) {\n  if (duplications == null) {\n    return {};\n  }\n\n  const duplicationsByLine: { [line: number]: number[] } = {};\n\n  duplications.forEach(({ blocks }, duplicationIndex) => {\n    blocks.forEach(block => {\n      // eslint-disable-next-line no-underscore-dangle\n      if (block._ref === '1') {\n        for (let line = block.from; line < block.from + block.size; line++) {\n          if (!(line in duplicationsByLine)) {\n            duplicationsByLine[line] = [];\n          }\n          duplicationsByLine[line].push(duplicationIndex);\n        }\n      }\n    });\n  });\n\n  return duplicationsByLine;\n}\n\nexport function symbolsByLine(sources: T.SourceLine[]) {\n  const index: { [line: number]: string[] } = {};\n  sources.forEach(line => {\n    const tokens = splitByTokens(line.code || '');\n    const symbols = flatten(\n      tokens.map(token => {\n        const keys = token.className.match(/sym-\\d+/g);\n        return keys != null ? keys : [];\n      })\n    );\n    index[line.line] = symbols.filter(key => key);\n  });\n  return index;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { uniq } from 'lodash';\n\nexport interface Token {\n  className: string;\n  markers: number[];\n  text: string;\n}\n\nconst ISSUE_LOCATION_CLASS = 'source-line-code-issue';\n\nexport function splitByTokens(code: string, rootClassName = ''): Token[] {\n  const container = document.createElement('div');\n  let tokens: Token[] = [];\n  container.innerHTML = code;\n  [].forEach.call(container.childNodes, (node: Element) => {\n    if (node.nodeType === 1) {\n      // ELEMENT NODE\n      const fullClassName = rootClassName ? rootClassName + ' ' + node.className : node.className;\n      const innerTokens = splitByTokens(node.innerHTML, fullClassName);\n      tokens = tokens.concat(innerTokens);\n    }\n    if (node.nodeType === 3 && node.nodeValue) {\n      // TEXT NODE\n      tokens.push({ className: rootClassName, markers: [], text: node.nodeValue });\n    }\n  });\n  return tokens;\n}\n\nexport function highlightSymbol(tokens: Token[], symbol: string): Token[] {\n  const symbolRegExp = new RegExp(`\\\\b${symbol}\\\\b`);\n  return tokens.map(token =>\n    symbolRegExp.test(token.className)\n      ? { ...token, className: `${token.className} highlighted` }\n      : token\n  );\n}\n\n/**\n * Intersect two ranges\n * @param s1 Start position of the first range\n * @param e1 End position of the first range\n * @param s2 Start position of the second range\n * @param e2 End position of the second range\n */\nfunction intersect(s1: number, e1: number, s2: number, e2: number) {\n  return { from: Math.max(s1, s2), to: Math.min(e1, e2) };\n}\n\n/**\n * Get the substring of a string\n * @param str A string\n * @param from \"From\" offset\n * @param to \"To\" offset\n * @param acc Global offset to eliminate\n */\nfunction part(str: string, from: number, to: number, acc: number): string {\n  // we do not want negative number as the first argument of `substr`\n  return from >= acc ? str.substr(from - acc, to - from) : str.substr(0, to - from);\n}\n\n/**\n * Highlight issue locations in the list of tokens\n */\nexport function highlightIssueLocations(\n  tokens: Token[],\n  issueLocations: T.LinearIssueLocation[],\n  rootClassName: string = ISSUE_LOCATION_CLASS\n): Token[] {\n  issueLocations.forEach(location => {\n    const nextTokens: Token[] = [];\n    let acc = 0;\n    let markerAdded = location.line !== location.startLine;\n    tokens.forEach(token => {\n      const x = intersect(acc, acc + token.text.length, location.from, location.to);\n      const p1 = part(token.text, acc, x.from, acc);\n      const p2 = part(token.text, x.from, x.to, acc);\n      const p3 = part(token.text, x.to, acc + token.text.length, acc);\n      if (p1.length) {\n        nextTokens.push({ ...token, text: p1 });\n      }\n      if (p2.length) {\n        const newClassName =\n          token.className.indexOf(rootClassName) === -1\n            ? `${token.className} ${rootClassName}`\n            : token.className;\n        nextTokens.push({\n          className: newClassName,\n          markers:\n            !markerAdded && location.index != null\n              ? uniq([...token.markers, location.index])\n              : token.markers,\n          text: p2\n        });\n        markerAdded = true;\n      }\n      if (p3.length) {\n        nextTokens.push({ ...token, text: p3 });\n      }\n      acc += token.text.length;\n    });\n    tokens = nextTokens.slice();\n  });\n  return tokens;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nexport function getLinearLocations(textRange: T.TextRange | undefined): T.LinearIssueLocation[] {\n  if (!textRange) {\n    return [];\n  }\n  const locations = [];\n\n  // go through all lines of the `textRange`\n  for (let line = textRange.startLine; line <= textRange.endLine; line++) {\n    // TODO fix 999999\n    const from = line === textRange.startLine ? textRange.startOffset : 0;\n    const to = line === textRange.endLine ? textRange.endOffset : 999999;\n    locations.push({ line, from, to });\n  }\n  return locations;\n}\n\nexport function getSecondaryIssueLocationsForLine(\n  line: T.SourceLine,\n  highlightedLocations: (T.FlowLocation | undefined)[] | undefined\n): T.LinearIssueLocation[] {\n  if (!highlightedLocations) {\n    return [];\n  }\n  return highlightedLocations.reduce((locations, location) => {\n    const linearLocations: T.LinearIssueLocation[] = location\n      ? getLinearLocations(location.textRange)\n          .filter(l => l.line === line.line)\n          .map(l => ({\n            ...l,\n            startLine: location.textRange.startLine,\n            index: location.index,\n            text: location.msg\n          }))\n      : [];\n    return [...locations, ...linearLocations];\n  }, []);\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { BranchLike } from '../../types/branch-like';\n\ninterface SourceViewerContextShape {\n  branchLike?: BranchLike;\n  file: T.SourceViewerFile;\n}\n\nexport const SourceViewerContext = React.createContext<SourceViewerContextShape>({\n  branchLike: {} as BranchLike,\n  file: {} as T.SourceViewerFile\n});\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport Icon, { IconProps } from './Icon';\n\nexport default function ExpandSnippetIcon({ fill = 'currentColor', ...iconProps }: IconProps) {\n  return (\n    <Icon {...iconProps}>\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path\n          d=\"M8 1v4H4\"\n          stroke={fill}\n          strokeWidth=\"2\"\n          transform=\"scale(-.83333 -.84583) rotate(45 7.66 -19.75)\"\n        />\n        <path d=\"M3 5.78h10v1.7H3z\" fill={fill} />\n        <path d=\"M7.17 2.4h1.66v5.07H7.17z\" fill={fill} />\n        <g>\n          <path\n            d=\"M8.16 1.81V6.1H3.9\"\n            stroke={fill}\n            strokeWidth=\"2\"\n            transform=\"scale(.83333 .84583) rotate(45 -4.2 13.2)\"\n          />\n          <path d=\"M13 10.01H3v-1.7h10z\" fill={fill} />\n          <path d=\"M8.83 13.4H7.17V9.15h1.66z\" fill={fill} />\n        </g>\n      </g>\n    </Icon>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { Link } from 'react-router';\nimport { ButtonIcon } from '../../components/controls/buttons';\nimport { ClipboardIconButton } from '../../components/controls/clipboard';\nimport ExpandSnippetIcon from '../../components/icons/ExpandSnippetIcon';\nimport QualifierIcon from '../../components/icons/QualifierIcon';\nimport DeferredSpinner from '../../components/ui/DeferredSpinner';\nimport { getBranchLikeQuery } from '../../helpers/branch-like';\nimport { translate } from '../../helpers/l10n';\nimport { collapsedDirFromPath, fileFromPath } from '../../helpers/path';\nimport { getBranchLikeUrl, getComponentIssuesUrl, getPathUrlAsString } from '../../helpers/urls';\nimport { BranchLike } from '../../types/branch-like';\nimport { ComponentQualifier } from '../../types/component';\nimport './SourceViewerHeaderSlim.css';\n\nexport interface Props {\n  branchLike: BranchLike | undefined;\n  expandable?: boolean;\n  displayProjectName?: boolean;\n  linkToProject?: boolean;\n  loading?: boolean;\n  onExpand?: () => void;\n  sourceViewerFile: T.SourceViewerFile;\n}\n\nexport default function SourceViewerHeaderSlim(props: Props) {\n  const {\n    branchLike,\n    expandable,\n    displayProjectName = true,\n    linkToProject = true,\n    loading,\n    onExpand,\n    sourceViewerFile\n  } = props;\n  const { measures, path, project, projectName, q, subProject, subProjectName } = sourceViewerFile;\n\n  const projectNameLabel = (\n    <>\n      <QualifierIcon qualifier={ComponentQualifier.Project} /> <span>{projectName}</span>\n    </>\n  );\n\n  return (\n    <div className=\"source-viewer-header-slim display-flex-row display-flex-space-between\">\n      <div className=\"display-flex-center flex-1\">\n        {displayProjectName && (\n          <div className=\"spacer-right\">\n            {linkToProject ? (\n              <a\n                className=\"link-with-icon\"\n                href={getPathUrlAsString(getBranchLikeUrl(project, branchLike))}>\n                {projectNameLabel}\n              </a>\n            ) : (\n              projectNameLabel\n            )}\n          </div>\n        )}\n\n        {subProject !== undefined && (\n          <>\n            <QualifierIcon qualifier={ComponentQualifier.SubProject} />{' '}\n            <span className=\"spacer-right\">{subProjectName}</span>\n          </>\n        )}\n\n        <div className=\"spacer-right\">\n          <QualifierIcon qualifier={q} /> <span>{collapsedDirFromPath(path)}</span>\n          <span className=\"component-name-file\">{fileFromPath(path)}</span>\n        </div>\n\n        <div className=\"spacer-right\">\n          <ClipboardIconButton className=\"button-link link-no-underline\" copyValue={path} />\n        </div>\n      </div>\n\n      {measures.issues !== undefined && (\n        <div\n          className={classNames('flex-0 big-spacer-left', {\n            'little-spacer-right': !expandable || loading\n          })}>\n          <Link\n            to={getComponentIssuesUrl(project, {\n              ...getBranchLikeQuery(branchLike),\n              files: path,\n              resolved: 'false'\n            })}>\n            {translate('source_viewer.view_all_issues')}\n          </Link>\n        </div>\n      )}\n\n      {expandable && (\n        <DeferredSpinner className=\"little-spacer-right\" loading={loading}>\n          <div className=\"flex-0 big-spacer-left\">\n            <ButtonIcon className=\"js-actions\" onClick={onExpand}>\n              <ExpandSnippetIcon />\n            </ButtonIcon>\n          </div>\n        </DeferredSpinner>\n      )}\n    </div>\n  );\n}\n","var api = require(\"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../node_modules/postcss-loader/src/index.js??postcss!./SourceViewerHeaderSlim.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".source-viewer-header-slim{padding:4px 10px;border-bottom:1px solid #cdcdcd;background-color:#f3f3f3;align-items:center;min-height:25px}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","var api = require(\"!../../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./Line.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".source-line:hover .source-line-coverage,.source-line:hover .source-line-duplications,.source-line:hover .source-line-duplications-extra,.source-line:hover .source-line-issues,.source-line:hover .source-line-number,.source-line:hover .source-line-scm{border-color:#e9e9e9;background-color:#e9e9e9}.source-line:hover .source-line-code{background-color:#f5f5f5}.source-line [role=button]{cursor:pointer}.source-line-highlighted .source-line-coverage,.source-line-highlighted .source-line-duplications,.source-line-highlighted .source-line-duplications-extra,.source-line-highlighted .source-line-issues,.source-line-highlighted .source-line-number,.source-line-highlighted .source-line-scm,.source-line-highlighted:hover .source-line-coverage,.source-line-highlighted:hover .source-line-duplications,.source-line-highlighted:hover .source-line-duplications-extra,.source-line-highlighted:hover .source-line-issues,.source-line-highlighted:hover .source-line-number,.source-line-highlighted:hover .source-line-scm{border-color:#c4dfec!important;background-color:#c4dfec}.source-line-highlighted .source-line-code,.source-line-highlighted:hover .source-line-code{background-color:#d9edf7}.source-line-filtered .source-line-code{background-color:#fbf3d5!important}.source-line-filtered.source-line-highlighted .source-line-code,.source-line-filtered.source-line-highlighted:hover .source-line-code{background-color:#cdd9c4!important}.source-line-filtered.source-line-filtered-dark .source-line-code{background-color:#f9ebb7!important}.source-line-filtered.source-line-filtered-dark:hover .source-line-code,.source-line-filtered:hover .source-line-code{background-color:#f1e8cb!important}.source-line-last .source-line-code{padding-bottom:160px}.source-line-number,.source-line-scm,.source-viewer pre{line-height:18px;font-family:Consolas,Ubuntu Mono,Liberation Mono,Menlo,Courier,monospace;font-size:12px}.source-line-code{position:relative;padding:0 10px}.source-line-code pre{float:left;word-wrap:break-word;white-space:pre-wrap}.source-line-code .issue-list{margin-left:-10px;margin-right:-10px}.source-line-code-inner{min-height:18px}.source-line-code-inner:after,.source-line-code-inner:before{display:table;content:\\\"\\\";line-height:0}.source-line-code-inner:after{clear:both}.source-line-code-inner pre{-moz-tab-size:4;tab-size:4}.source-line-code-issue{display:inline-block;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAGCAYAAAAPDoR2AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo1M0M2Rjk4M0M3QUYxMUUzODkzRUREMUM5OTNDMjY4QSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo1M0M2Rjk4NEM3QUYxMUUzODkzRUREMUM5OTNDMjY4QSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjUzQzZGOTgxQzdBRjExRTM4OTNFREQxQzk5M0MyNjhBIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjUzQzZGOTgyQzdBRjExRTM4OTNFREQxQzk5M0MyNjhBIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+bcqJtQAAAEhJREFUeNpi+G+swwDGDAwgbAWlwZiJAQFCgfgwEIfDRaC67ID4NRDnQ2kQnwFZwgFqnANMAQOUYY9sF0wBiCGH5CBkrAgQYACuWi4sSGW8yAAAAABJRU5ErkJggg==);background-repeat:repeat-x;background-size:4px;background-position:bottom}.source-meta{position:relative;vertical-align:top;width:1px;background-clip:padding-box;-webkit-user-select:none;-ms-user-select:none;user-select:none}.source-meta:focus{outline:none}.source-line-number{min-width:18px;padding:0 10px;background-color:#f3f3f3;color:#666;text-align:right}.source-line-issues{position:relative;padding:0 2px;background-color:#f3f3f3;white-space:nowrap}.source-line-with-issues svg{padding-right:2px;vertical-align:middle}.source-line-issues-counter{position:absolute;left:17px;line-height:8px;font-size:8px;z-index:900}.source-line-coverage,.source-line-duplications,.source-line-duplications-extra{background-color:#f3f3f3}.source-line-duplications-extra{display:none}.source-line-scm{padding:0 5px;background-color:#f3f3f3}.source-line-scm .dropdown{display:block}.source-line-scm [role=button]{height:18px}.source-line-scm-inner{max-width:40px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.source-line-bar{width:5px;height:18px}.source-line-bar:focus{outline:none}.source-line-covered{background-color:#b4dd78!important}.source-line-partially-covered,.source-line-uncovered{background-color:#a4030f!important}.source-line-partially-covered{background-image:repeating-linear-gradient(45deg,hsla(0,0%,100%,.5) 4px,transparent 0,transparent 8px,hsla(0,0%,100%,.5) 0,hsla(0,0%,100%,.5) 12px,transparent 0,transparent 16px,hsla(0,0%,100%,.5) 0,hsla(0,0%,100%,.5) 20px)!important}.source-line-duplicated{background-color:#797979!important}.source-viewer-bubble-popup a{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:13px;text-align:left;-webkit-user-select:text;-ms-user-select:text;user-select:text;border-bottom:none;transition:none;color:unset}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { intersection } from 'lodash';\n\nexport function optimizeHighlightedSymbols(\n  symbolsForLine: string[] = [],\n  highlightedSymbols: string[] = []\n): string[] | undefined {\n  const symbols = intersection(symbolsForLine, highlightedSymbols);\n\n  return symbols.length ? symbols : undefined;\n}\n\nexport function optimizeLocationMessage(\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined,\n  optimizedSecondaryIssueLocations: T.LinearIssueLocation[]\n) {\n  return highlightedLocationMessage != null &&\n    optimizedSecondaryIssueLocations.some(\n      location => location.index === highlightedLocationMessage.index\n    )\n    ? highlightedLocationMessage\n    : undefined;\n}\n\nexport function optimizeSelectedIssue(selectedIssue: string | undefined, issuesForLine: T.Issue[]) {\n  return selectedIssue !== undefined && issuesForLine.find(issue => issue.key === selectedIssue)\n    ? selectedIssue\n    : undefined;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nconst LINES_ABOVE = 5;\nconst LINES_BELOW = 5;\nexport const MERGE_DISTANCE = 11; // Merge if snippets are eleven lines away (separated by 10 lines) or fewer\nexport const LINES_BELOW_ISSUE = 9;\nexport const EXPAND_BY_LINES = 50;\n\nfunction unknownComponent(key: string): T.SnippetsByComponent {\n  return {\n    component: {\n      key,\n      measures: {},\n      path: '',\n      project: '',\n      projectName: '',\n      q: 'FIL',\n      uuid: ''\n    },\n    sources: []\n  };\n}\n\nfunction collision([startA, endA]: number[], [startB, endB]: number[]) {\n  return !(startA > endB + MERGE_DISTANCE || endA < startB - MERGE_DISTANCE);\n}\n\nexport function getPrimaryLocation(issue: T.Issue): T.FlowLocation {\n  return {\n    component: issue.component,\n    textRange: issue.textRange || {\n      endLine: 0,\n      endOffset: 0,\n      startLine: 0,\n      startOffset: 0\n    }\n  };\n}\n\nfunction addLinesBellow(params: { issue: T.Issue; locationEnd: number }) {\n  const { issue, locationEnd } = params;\n  const issueEndLine = (issue.textRange && issue.textRange.endLine) || 0;\n\n  if (!issueEndLine || issueEndLine === locationEnd) {\n    return locationEnd + LINES_BELOW_ISSUE;\n  }\n\n  return locationEnd + LINES_BELOW;\n}\n\nexport function createSnippets(params: {\n  component: string;\n  issue: T.Issue;\n  locations: T.FlowLocation[];\n}): T.Snippet[] {\n  const { component, issue, locations } = params;\n\n  const hasSecondaryLocations = issue.secondaryLocations.length > 0;\n  const addIssueLocation =\n    hasSecondaryLocations && issue.component === component && issue.textRange !== undefined;\n\n  // For each location: compute its range, and then compare with other ranges\n  // to merge snippets that collide.\n  const ranges = (addIssueLocation ? [getPrimaryLocation(issue), ...locations] : locations).reduce(\n    (snippets: T.Snippet[], loc, index) => {\n      const startIndex = Math.max(1, loc.textRange.startLine - LINES_ABOVE);\n      const endIndex = addLinesBellow({ issue, locationEnd: loc.textRange.endLine });\n\n      let firstCollision: { start: number; end: number } | undefined;\n\n      // Remove ranges that collide into the first collision\n      snippets = snippets.filter(snippet => {\n        if (collision([snippet.start, snippet.end], [startIndex, endIndex])) {\n          let keep = false;\n          // Check if we've already collided\n          if (!firstCollision) {\n            firstCollision = snippet;\n            keep = true;\n          }\n          // Merge with first collision:\n          firstCollision.start = Math.min(startIndex, snippet.start, firstCollision.start);\n          firstCollision.end = Math.max(endIndex, snippet.end, firstCollision.end);\n\n          // remove the range if it was not the first collision\n          return keep;\n        }\n        return true;\n      });\n\n      if (firstCollision === undefined) {\n        snippets.push({\n          start: startIndex,\n          end: endIndex,\n          index\n        });\n      }\n\n      return snippets;\n    },\n    []\n  );\n\n  // Sort snippets by line number in the case of secondary locations\n  // Preserve location order for flows!\n  return hasSecondaryLocations ? ranges.sort((a, b) => a.start - b.start) : ranges;\n}\n\nexport function linesForSnippets(snippets: T.Snippet[], componentLines: T.LineMap) {\n  return snippets\n    .map(snippet => {\n      const lines = [];\n      for (let i = snippet.start; i <= snippet.end; i++) {\n        if (componentLines[i]) {\n          lines.push(componentLines[i]);\n        }\n      }\n      return lines;\n    })\n    .filter(snippet => snippet.length > 0);\n}\n\nexport function groupLocationsByComponent(\n  issue: T.Issue,\n  locations: T.FlowLocation[],\n  components: { [key: string]: T.SnippetsByComponent }\n) {\n  let currentComponent = '';\n  let currentGroup: T.SnippetGroup;\n  const groups: T.SnippetGroup[] = [];\n\n  const addGroup = (componentKey: string) => {\n    currentGroup = {\n      ...(components[componentKey] || unknownComponent(componentKey)),\n      locations: []\n    };\n    groups.push(currentGroup);\n    currentComponent = componentKey;\n  };\n\n  if (\n    issue.secondaryLocations.length > 0 &&\n    locations.every(loc => loc.component !== issue.component)\n  ) {\n    addGroup(issue.component);\n  }\n\n  locations.forEach((loc, index) => {\n    if (loc.component !== currentComponent) {\n      addGroup(loc.component);\n    }\n    loc.index = index;\n    currentGroup.locations.push(loc);\n  });\n\n  return groups;\n}\n\nexport function expandSnippet({\n  direction,\n  snippetIndex,\n  snippets\n}: {\n  direction: T.ExpandDirection;\n  snippetIndex: number;\n  snippets: T.Snippet[];\n}) {\n  const snippetToExpand = snippets.find(s => s.index === snippetIndex);\n  if (!snippetToExpand) {\n    throw new Error(`Snippet ${snippetIndex} not found`);\n  }\n\n  snippetToExpand.start = Math.max(\n    0,\n    snippetToExpand.start - (direction === 'up' ? EXPAND_BY_LINES : 0)\n  );\n  snippetToExpand.end += direction === 'down' ? EXPAND_BY_LINES : 0;\n\n  return snippets.map(snippet => {\n    if (snippet.index === snippetIndex) {\n      return snippetToExpand;\n    }\n    if (collision([snippet.start, snippet.end], [snippetToExpand.start, snippetToExpand.end])) {\n      // Merge with expanded snippet\n      snippetToExpand.start = Math.min(snippet.start, snippetToExpand.start);\n      snippetToExpand.end = Math.max(snippet.end, snippetToExpand.end);\n      snippet.toDelete = true;\n    }\n    return snippet;\n  });\n}\n\nexport function inSnippet(line: number, snippet: T.SourceLine[]) {\n  return line >= snippet[0].line && line <= snippet[snippet.length - 1].line;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { BranchLike } from '../../../types/branch-like';\nimport Issue from '../../issue/Issue';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  displayIssueLocationsCount?: boolean;\n  displayIssueLocationsLink?: boolean;\n  issuePopup: { issue: string; name: string } | undefined;\n  issues: T.Issue[];\n  onIssueChange: (issue: T.Issue) => void;\n  onIssueClick: (issueKey: string) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  selectedIssue: string | undefined;\n}\n\nexport default function LineIssuesList(props: Props) {\n  const { issuePopup } = props;\n\n  return (\n    <div className=\"issue-list\">\n      {props.issues.map(issue => (\n        <Issue\n          branchLike={props.branchLike}\n          displayLocationsCount={props.displayIssueLocationsCount}\n          displayLocationsLink={props.displayIssueLocationsLink}\n          issue={issue}\n          key={issue.key}\n          onChange={props.onIssueChange}\n          onClick={props.onIssueClick}\n          onPopupToggle={props.onIssuePopupToggle}\n          openPopup={issuePopup && issuePopup.issue === issue.key ? issuePopup.name : undefined}\n          selected={props.selectedIssue === issue.key}\n        />\n      ))}\n    </div>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { BranchLike } from '../../../types/branch-like';\nimport LocationIndex from '../../common/LocationIndex';\nimport LocationMessage from '../../common/LocationMessage';\nimport {\n  highlightIssueLocations,\n  highlightSymbol,\n  splitByTokens,\n  Token\n} from '../helpers/highlight';\nimport LineIssuesList from './LineIssuesList';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  displayIssueLocationsCount?: boolean;\n  displayIssueLocationsLink?: boolean;\n  displayLocationMarkers?: boolean;\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  highlightedSymbols: string[] | undefined;\n  issueLocations: T.LinearIssueLocation[];\n  issuePopup: { issue: string; name: string } | undefined;\n  issues: T.Issue[];\n  line: T.SourceLine;\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onIssueSelect: (issueKey: string) => void;\n  onLocationSelect: ((index: number) => void) | undefined;\n  onSymbolClick: (symbols: Array<string>) => void;\n  padding?: number;\n  scroll?: (element: HTMLElement) => void;\n  secondaryIssueLocations: T.LinearIssueLocation[];\n  selectedIssue: string | undefined;\n  showIssues?: boolean;\n}\n\ninterface State {\n  tokens: Token[];\n}\n\nexport default class LineCode extends React.PureComponent<Props, State> {\n  activeMarkerNode?: HTMLElement | null;\n  codeNode?: HTMLElement | null;\n  symbols?: NodeListOf<HTMLElement>;\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      tokens: splitByTokens(props.line.code || '')\n    };\n  }\n\n  componentDidMount() {\n    this.attachEvents();\n    if (this.props.highlightedLocationMessage && this.activeMarkerNode && this.props.scroll) {\n      this.props.scroll(this.activeMarkerNode);\n    }\n  }\n\n  componentWillReceiveProps(nextProps: Props) {\n    if (nextProps.line.code !== this.props.line.code) {\n      this.setState({\n        tokens: splitByTokens(nextProps.line.code || '')\n      });\n    }\n  }\n\n  componentWillUpdate() {\n    this.detachEvents();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    this.attachEvents();\n    if (\n      this.props.highlightedLocationMessage &&\n      (!prevProps.highlightedLocationMessage ||\n        prevProps.highlightedLocationMessage.index !==\n          this.props.highlightedLocationMessage.index) &&\n      this.activeMarkerNode &&\n      this.props.scroll\n    ) {\n      this.props.scroll(this.activeMarkerNode);\n    }\n  }\n\n  componentWillUnmount() {\n    this.detachEvents();\n  }\n\n  attachEvents() {\n    if (this.codeNode) {\n      this.symbols = this.codeNode.querySelectorAll('.sym');\n      if (this.symbols) {\n        for (let i = 0; i < this.symbols.length; i++) {\n          const symbol = this.symbols[i];\n          symbol.addEventListener('click', this.handleSymbolClick);\n        }\n      }\n    }\n  }\n\n  detachEvents() {\n    if (this.symbols) {\n      for (let i = 0; i < this.symbols.length; i++) {\n        const symbol = this.symbols[i];\n        symbol.addEventListener('click', this.handleSymbolClick);\n      }\n    }\n  }\n\n  handleSymbolClick = (event: MouseEvent) => {\n    event.preventDefault();\n    const keys = (event.currentTarget as HTMLElement).className.match(/sym-\\d+/g);\n    if (keys && keys.length > 0) {\n      this.props.onSymbolClick(keys);\n    }\n  };\n\n  renderMarker(index: number, message: string | undefined, selected: boolean, leading: boolean) {\n    const { onLocationSelect } = this.props;\n    const onClick = onLocationSelect ? () => onLocationSelect(index) : undefined;\n    const ref = selected ? (node: HTMLElement | null) => (this.activeMarkerNode = node) : undefined;\n    return (\n      <LocationIndex\n        key={`marker-${index}`}\n        leading={leading}\n        onClick={onClick}\n        selected={selected}>\n        <span ref={ref}>{index + 1}</span>\n        {message && <LocationMessage selected={true}>{message}</LocationMessage>}\n      </LocationIndex>\n    );\n  }\n\n  render() {\n    const {\n      highlightedLocationMessage,\n      highlightedSymbols,\n      issues,\n      issueLocations,\n      line,\n      onIssueSelect,\n      padding,\n      secondaryIssueLocations,\n      selectedIssue,\n      showIssues\n    } = this.props;\n\n    let tokens = [...this.state.tokens];\n\n    if (highlightedSymbols) {\n      highlightedSymbols.forEach(symbol => {\n        tokens = highlightSymbol(tokens, symbol);\n      });\n    }\n\n    if (issueLocations.length > 0) {\n      tokens = highlightIssueLocations(tokens, issueLocations);\n    }\n\n    if (secondaryIssueLocations) {\n      tokens = highlightIssueLocations(tokens, secondaryIssueLocations, 'issue-location');\n\n      if (highlightedLocationMessage) {\n        const location = secondaryIssueLocations.find(\n          location => location.index === highlightedLocationMessage.index\n        );\n        if (location) {\n          tokens = highlightIssueLocations(tokens, [location], 'selected');\n        }\n      }\n    }\n\n    const className = classNames('source-line-code', 'code', {\n      'has-issues': issues.length > 0\n    });\n\n    const renderedTokens: React.ReactNode[] = [];\n\n    // track if the first marker is displayed before the source code\n    // set `false` for the first token in a row\n    let leadingMarker = false;\n\n    tokens.forEach((token, index) => {\n      if (this.props.displayLocationMarkers && token.markers.length > 0) {\n        token.markers.forEach(marker => {\n          const selected =\n            highlightedLocationMessage !== undefined && highlightedLocationMessage.index === marker;\n          const loc = secondaryIssueLocations.find(loc => loc.index === marker);\n          const message = loc && loc.text;\n          renderedTokens.push(this.renderMarker(marker, message, selected, leadingMarker));\n        });\n      }\n      renderedTokens.push(\n        <span className={token.className} key={index}>\n          {token.text}\n        </span>\n      );\n\n      // keep leadingMarker truthy if previous token has only whitespaces\n      leadingMarker = (index === 0 ? true : leadingMarker) && !token.text.trim().length;\n    });\n\n    const style = padding ? { paddingBottom: `${padding}px` } : undefined;\n    const filteredSelectedIssues = issues.filter(i => i.key === selectedIssue);\n\n    return (\n      <td className={className} data-line-number={line.line} style={style}>\n        <div className=\"source-line-code-inner\">\n          <pre ref={node => (this.codeNode = node)}>{renderedTokens}</pre>\n        </div>\n        {showIssues && issues.length > 0 && (\n          <LineIssuesList\n            branchLike={this.props.branchLike}\n            displayIssueLocationsCount={this.props.displayIssueLocationsCount}\n            displayIssueLocationsLink={this.props.displayIssueLocationsLink}\n            issuePopup={this.props.issuePopup}\n            issues={issues}\n            onIssueChange={this.props.onIssueChange}\n            onIssueClick={onIssueSelect}\n            onIssuePopupToggle={this.props.onIssuePopupToggle}\n            selectedIssue={selectedIssue}\n          />\n        )}\n        {selectedIssue && !showIssues && (\n          <LineIssuesList\n            branchLike={this.props.branchLike}\n            issuePopup={this.props.issuePopup}\n            issues={filteredSelectedIssues}\n            onIssueChange={this.props.onIssueChange}\n            onIssueClick={onIssueSelect}\n            onIssuePopupToggle={this.props.onIssuePopupToggle}\n            selectedIssue={selectedIssue}\n          />\n        )}\n      </td>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport Tooltip from '../../../components/controls/Tooltip';\nimport { translate, translateWithParameters } from '../../../helpers/l10n';\n\nexport interface LineCoverageProps {\n  line: T.SourceLine;\n  scroll?: (element: HTMLElement) => void;\n  scrollToUncoveredLine?: boolean;\n}\n\nexport function LineCoverage({ line, scroll, scrollToUncoveredLine }: LineCoverageProps) {\n  const coverageMarker = React.useRef<HTMLTableDataCellElement>(null);\n  React.useEffect(() => {\n    if (scrollToUncoveredLine && scroll && coverageMarker.current) {\n      scroll(coverageMarker.current);\n    }\n  }, [scrollToUncoveredLine, scroll, coverageMarker]);\n\n  const className =\n    'source-meta source-line-coverage' +\n    (line.coverageStatus != null ? ` source-line-${line.coverageStatus}` : '');\n  const status = getStatusTooltip(line);\n\n  return (\n    <td className={className} data-line-number={line.line} ref={coverageMarker}>\n      <Tooltip overlay={status} placement=\"bottom\">\n        <div aria-label={status} className=\"source-line-bar\" />\n      </Tooltip>\n    </td>\n  );\n}\n\nfunction getStatusTooltip(line: T.SourceLine) {\n  if (line.coverageStatus === 'uncovered') {\n    if (line.conditions) {\n      return translateWithParameters('source_viewer.tooltip.uncovered.conditions', line.conditions);\n    } else {\n      return translate('source_viewer.tooltip.uncovered');\n    }\n  } else if (line.coverageStatus === 'covered') {\n    if (line.conditions) {\n      return translateWithParameters('source_viewer.tooltip.covered.conditions', line.conditions);\n    } else {\n      return translate('source_viewer.tooltip.covered');\n    }\n  } else if (line.coverageStatus === 'partially-covered') {\n    if (line.conditions) {\n      return translateWithParameters(\n        'source_viewer.tooltip.partially-covered.conditions',\n        line.coveredConditions || 0,\n        line.conditions\n      );\n    } else {\n      return translate('source_viewer.tooltip.partially-covered');\n    }\n  }\n  return undefined;\n}\n\nexport default React.memo(LineCoverage);\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { DropdownOverlay } from '../../../components/controls/Dropdown';\nimport Toggler from '../../../components/controls/Toggler';\nimport Tooltip from '../../../components/controls/Tooltip';\nimport { PopupPlacement } from '../../../components/ui/popups';\nimport { translate } from '../../../helpers/l10n';\n\nexport interface LineDuplicationBlockProps {\n  blocksLoaded: boolean;\n  duplicated: boolean;\n  index: number;\n  line: T.SourceLine;\n  onClick?: (line: T.SourceLine) => void;\n  renderDuplicationPopup: (index: number, line: number) => React.ReactNode;\n}\n\nexport function LineDuplicationBlock(props: LineDuplicationBlockProps) {\n  const { blocksLoaded, duplicated, index, line } = props;\n  const [dropdownOpen, setDropdownOpen] = React.useState(false);\n\n  const className = classNames('source-meta', 'source-line-duplications', {\n    'source-line-duplicated': duplicated\n  });\n\n  return duplicated ? (\n    <td className={className} data-index={index} data-line-number={line.line}>\n      <Tooltip\n        overlay={dropdownOpen ? undefined : translate('source_viewer.tooltip.duplicated_block')}\n        placement=\"right\">\n        <div>\n          <Toggler\n            onRequestClose={() => setDropdownOpen(false)}\n            open={dropdownOpen}\n            overlay={\n              <DropdownOverlay placement={PopupPlacement.RightTop}>\n                {props.renderDuplicationPopup(index, line.line)}\n              </DropdownOverlay>\n            }>\n            <div\n              aria-label={translate('source_viewer.tooltip.duplicated_block')}\n              className=\"source-line-bar\"\n              onClick={() => {\n                setDropdownOpen(true);\n                if (!blocksLoaded && line.duplicated && props.onClick) {\n                  props.onClick(line);\n                }\n              }}\n              role=\"button\"\n              tabIndex={0}\n            />\n          </Toggler>\n        </div>\n      </Tooltip>\n    </td>\n  ) : (\n    <td className={className} data-index={index} data-line-number={line.line}>\n      <div className=\"source-line-bar\" />\n    </td>\n  );\n}\n\nexport default React.memo(LineDuplicationBlock);\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport { uniq } from 'lodash';\nimport * as React from 'react';\nimport Tooltip from '../../../components/controls/Tooltip';\nimport IssueIcon from '../../../components/icons/IssueIcon';\nimport { sortByType } from '../../../helpers/issues';\nimport { translate, translateWithParameters } from '../../../helpers/l10n';\n\nexport interface LineIssuesIndicatorProps {\n  issues: T.Issue[];\n  issuesOpen?: boolean;\n  line: T.SourceLine;\n  onClick: () => void;\n}\n\nexport function LineIssuesIndicator(props: LineIssuesIndicatorProps) {\n  const { issues, issuesOpen, line } = props;\n  const hasIssues = issues.length > 0;\n  const className = classNames('source-meta', 'source-line-issues', {\n    'source-line-with-issues': hasIssues\n  });\n\n  if (!hasIssues) {\n    return <td className={className} data-line-number={line.line} />;\n  }\n\n  const mostImportantIssue = sortByType(issues)[0];\n  const issueTypes = uniq(issues.map(i => i.type));\n\n  let tooltipContent;\n  if (issueTypes.length > 1) {\n    tooltipContent = translate('source_viewer.issues_on_line.multiple_issues');\n  } else if (issues.length === 1) {\n    tooltipContent = translateWithParameters(\n      'source_viewer.issues_on_line.issue_of_type_X',\n      translate('issue.type', mostImportantIssue.type)\n    );\n  } else {\n    tooltipContent = translateWithParameters(\n      'source_viewer.issues_on_line.X_issues_of_type_Y',\n      issues.length,\n      translate('issue.type', mostImportantIssue.type, 'plural')\n    );\n  }\n\n  return (\n    <td className={className} data-line-number={line.line}>\n      <span\n        aria-label={translate('source_viewer.issues_on_line', issuesOpen ? 'hide' : 'show')}\n        onClick={(e: React.MouseEvent<HTMLElement>) => {\n          e.preventDefault();\n          e.currentTarget.blur();\n          props.onClick();\n        }}\n        role=\"button\"\n        tabIndex={0}>\n        <Tooltip overlay={tooltipContent}>\n          <IssueIcon type={mostImportantIssue.type} />\n        </Tooltip>\n        {issues.length > 1 && <span className=\"source-line-issues-counter\">{issues.length}</span>}\n      </span>\n    </td>\n  );\n}\n\nexport default React.memo(LineIssuesIndicator);\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { DropdownOverlay } from '../../../components/controls/Dropdown';\nimport { PopupPlacement } from '../../../components/ui/popups';\nimport { translate } from '../../../helpers/l10n';\nimport { getCodeUrl, getPathUrlAsString } from '../../../helpers/urls';\nimport { ActionsDropdownItem } from '../../controls/ActionsDropdown';\nimport { SourceViewerContext } from '../SourceViewerContext';\n\nexport interface LineOptionsPopupProps {\n  firstLineNumber: number;\n  line: T.SourceLine;\n}\n\nexport function LineOptionsPopup({ firstLineNumber, line }: LineOptionsPopupProps) {\n  return (\n    <SourceViewerContext.Consumer>\n      {({ branchLike, file }) => {\n        const codeLocation = getCodeUrl(file.project, branchLike, file.key, line.line);\n        const codeUrl = getPathUrlAsString(codeLocation, false);\n        const isAtTop = line.line - 4 < firstLineNumber;\n        return (\n          <DropdownOverlay\n            className=\"big-spacer-left\"\n            noPadding={true}\n            placement={isAtTop ? PopupPlacement.BottomLeft : PopupPlacement.TopLeft}>\n            <ul className=\"padded source-viewer-bubble-popup nowrap\">\n              <ActionsDropdownItem copyValue={codeUrl}>\n                {translate('component_viewer.copy_permalink')}\n              </ActionsDropdownItem>\n            </ul>\n          </DropdownOverlay>\n        );\n      }}\n    </SourceViewerContext.Consumer>\n  );\n}\n\nexport default React.memo(LineOptionsPopup);\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport Toggler from '../../../components/controls/Toggler';\nimport { translateWithParameters } from '../../../helpers/l10n';\nimport LineOptionsPopup from './LineOptionsPopup';\n\nexport interface LineNumberProps {\n  displayOptions: boolean;\n  firstLineNumber: number;\n  line: T.SourceLine;\n}\n\nexport function LineNumber({ displayOptions, firstLineNumber, line }: LineNumberProps) {\n  const [isOpen, setOpen] = React.useState<boolean>(false);\n  const { line: lineNumber } = line;\n  const hasLineNumber = !!lineNumber;\n\n  return hasLineNumber ? (\n    <td className=\"source-meta source-line-number\" data-line-number={lineNumber}>\n      {displayOptions ? (\n        <Toggler\n          closeOnClickOutside={true}\n          onRequestClose={() => setOpen(false)}\n          open={isOpen}\n          overlay={<LineOptionsPopup firstLineNumber={firstLineNumber} line={line} />}>\n          <span\n            aria-expanded={isOpen}\n            aria-haspopup={true}\n            aria-label={translateWithParameters('source_viewer.line_X', lineNumber)}\n            onClick={() => setOpen(true)}\n            role=\"button\"\n            tabIndex={0}>\n            {lineNumber}\n          </span>\n        </Toggler>\n      ) : (\n        lineNumber\n      )}\n    </td>\n  ) : (\n    <td className=\"source-meta source-line-number\" />\n  );\n}\n\nexport default React.memo(LineNumber);\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { translate } from '../../../helpers/l10n';\nimport DateFormatter from '../../intl/DateFormatter';\n\nexport interface SCMPopupProps {\n  line: T.SourceLine;\n}\n\nexport function SCMPopup({ line }: SCMPopupProps) {\n  const hasAuthor = line.scmAuthor !== undefined && line.scmAuthor !== '';\n  const hasDate = line.scmDate !== undefined;\n  return (\n    <div className=\"source-viewer-bubble-popup abs-width-400\">\n      {hasAuthor && (\n        <div>\n          <h4>{translate('author')}</h4>\n          {line.scmAuthor}\n        </div>\n      )}\n      {hasDate && (\n        <div className={classNames({ 'spacer-top': hasAuthor })}>\n          <h4>{translate('source_viewer.tooltip.scm.commited_on')}</h4>\n          <DateFormatter date={line.scmDate!} />\n        </div>\n      )}\n      {line.scmRevision && (\n        <div className={classNames({ 'spacer-top': hasAuthor || hasDate })}>\n          <h4>{translate('source_viewer.tooltip.scm.revision')}</h4>\n          {line.scmRevision}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default React.memo(SCMPopup);\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport Dropdown from '../../../components/controls/Dropdown';\nimport { PopupPlacement } from '../../../components/ui/popups';\nimport { translate, translateWithParameters } from '../../../helpers/l10n';\nimport SCMPopup from './SCMPopup';\n\nexport interface LineSCMProps {\n  line: T.SourceLine;\n  previousLine: T.SourceLine | undefined;\n}\n\nexport function LineSCM({ line, previousLine }: LineSCMProps) {\n  const hasPopup = !!line.line;\n  const cell = (\n    <div className=\"source-line-scm-inner\">\n      {isSCMChanged(line, previousLine) ? line.scmAuthor || '…' : ' '}\n    </div>\n  );\n\n  if (hasPopup) {\n    let ariaLabel = translate('source_viewer.click_for_scm_info');\n    if (line.scmAuthor) {\n      ariaLabel = `${translateWithParameters(\n        'source_viewer.author_X',\n        line.scmAuthor\n      )}, ${ariaLabel}`;\n    }\n\n    return (\n      <td className=\"source-meta source-line-scm\" data-line-number={line.line}>\n        <Dropdown overlay={<SCMPopup line={line} />} overlayPlacement={PopupPlacement.RightTop}>\n          <div aria-label={ariaLabel} role=\"button\">\n            {cell}\n          </div>\n        </Dropdown>\n      </td>\n    );\n  } else {\n    return (\n      <td className=\"source-meta source-line-scm\" data-line-number={line.line}>\n        {cell}\n      </td>\n    );\n  }\n}\n\nfunction isSCMChanged(s: T.SourceLine, p: T.SourceLine | undefined) {\n  let changed = true;\n  if (p != null && s.scmRevision != null && p.scmRevision != null) {\n    changed = s.scmRevision !== p.scmRevision || s.scmDate !== p.scmDate;\n  }\n  return changed;\n}\n\nexport default React.memo(LineSCM);\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport { times } from 'lodash';\nimport * as React from 'react';\nimport { BranchLike } from '../../../types/branch-like';\nimport './Line.css';\nimport LineCode from './LineCode';\nimport LineCoverage from './LineCoverage';\nimport LineDuplicationBlock from './LineDuplicationBlock';\nimport LineIssuesIndicator from './LineIssuesIndicator';\nimport LineNumber from './LineNumber';\nimport LineSCM from './LineSCM';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  displayAllIssues?: boolean;\n  displayCoverage: boolean;\n  displayDuplications: boolean;\n  displayIssueLocationsCount?: boolean;\n  displayIssueLocationsLink?: boolean;\n  displayIssues: boolean;\n  displayLineNumberOptions?: boolean;\n  displayLocationMarkers?: boolean;\n  displaySCM?: boolean;\n  duplications: number[];\n  duplicationsCount: number;\n  firstLineNumber: number;\n  highlighted: boolean;\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  highlightedSymbols: string[] | undefined;\n  issueLocations: T.LinearIssueLocation[];\n  issuePopup: { issue: string; name: string } | undefined;\n  issues: T.Issue[];\n  last: boolean;\n  line: T.SourceLine;\n  loadDuplications: (line: T.SourceLine) => void;\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issueKey: string, popupName: string, open?: boolean) => void;\n  onIssuesClose: (line: T.SourceLine) => void;\n  onIssueSelect: (issueKey: string) => void;\n  onIssuesOpen: (line: T.SourceLine) => void;\n  onIssueUnselect: () => void;\n  onLocationSelect: ((x: number) => void) | undefined;\n  onSymbolClick: (symbols: string[]) => void;\n  openIssues: boolean;\n  previousLine: T.SourceLine | undefined;\n  renderDuplicationPopup: (index: number, line: number) => React.ReactNode;\n  scroll?: (element: HTMLElement) => void;\n  scrollToUncoveredLine?: boolean;\n  secondaryIssueLocations: T.LinearIssueLocation[];\n  selectedIssue: string | undefined;\n  verticalBuffer?: number;\n}\n\nconst LINE_HEIGHT = 18;\n\nexport default class Line extends React.PureComponent<Props> {\n  handleIssuesIndicatorClick = () => {\n    if (this.props.openIssues) {\n      this.props.onIssuesClose(this.props.line);\n      this.props.onIssueUnselect();\n    } else {\n      this.props.onIssuesOpen(this.props.line);\n\n      const { issues } = this.props;\n      if (issues.length > 0) {\n        this.props.onIssueSelect(issues[0].key);\n      }\n    }\n  };\n\n  render() {\n    const {\n      branchLike,\n      displayAllIssues,\n      displayCoverage,\n      displayDuplications,\n      displayIssueLocationsCount,\n      displayIssueLocationsLink,\n      displayLineNumberOptions,\n      displayLocationMarkers,\n      highlightedLocationMessage,\n      displayIssues,\n      displaySCM = true,\n      duplications,\n      duplicationsCount,\n      firstLineNumber,\n      highlighted,\n      highlightedSymbols,\n      issueLocations,\n      issuePopup,\n      issues,\n      last,\n      line,\n      openIssues,\n      previousLine,\n      scrollToUncoveredLine,\n      secondaryIssueLocations,\n      selectedIssue,\n      verticalBuffer\n    } = this.props;\n\n    const className = classNames('source-line', {\n      'source-line-highlighted': highlighted,\n      'source-line-filtered': line.isNew,\n      'source-line-filtered-dark':\n        displayCoverage &&\n        (line.coverageStatus === 'uncovered' || line.coverageStatus === 'partially-covered'),\n      'source-line-last': last === true\n    });\n\n    const bottomPadding = verticalBuffer ? verticalBuffer * LINE_HEIGHT : undefined;\n\n    // default is true\n    const displayOptions = displayLineNumberOptions !== false;\n\n    return (\n      <tr className={className} data-line-number={line.line}>\n        <LineNumber displayOptions={displayOptions} firstLineNumber={firstLineNumber} line={line} />\n\n        {displaySCM && <LineSCM line={line} previousLine={previousLine} />}\n        {displayIssues && !displayAllIssues ? (\n          <LineIssuesIndicator\n            issues={issues}\n            issuesOpen={openIssues}\n            line={line}\n            onClick={this.handleIssuesIndicatorClick}\n          />\n        ) : (\n          <td className=\"source-meta source-line-issues\" />\n        )}\n\n        {displayDuplications && (\n          <LineDuplicationBlock\n            blocksLoaded={duplicationsCount > 0}\n            duplicated={Boolean(line.duplicated)}\n            index={0}\n            key={0}\n            line={this.props.line}\n            onClick={this.props.loadDuplications}\n            renderDuplicationPopup={this.props.renderDuplicationPopup}\n          />\n        )}\n\n        {duplicationsCount > 1 &&\n          times(duplicationsCount - 1, index => (\n            <LineDuplicationBlock\n              blocksLoaded={true}\n              duplicated={duplications.includes(index + 1)}\n              index={index + 1}\n              key={index + 1}\n              line={this.props.line}\n              renderDuplicationPopup={this.props.renderDuplicationPopup}\n            />\n          ))}\n\n        {displayCoverage && (\n          <LineCoverage\n            line={line}\n            scroll={this.props.scroll}\n            scrollToUncoveredLine={scrollToUncoveredLine}\n          />\n        )}\n\n        <LineCode\n          branchLike={branchLike}\n          displayIssueLocationsCount={displayIssueLocationsCount}\n          displayIssueLocationsLink={displayIssueLocationsLink}\n          displayLocationMarkers={displayLocationMarkers}\n          highlightedLocationMessage={highlightedLocationMessage}\n          highlightedSymbols={highlightedSymbols}\n          issueLocations={issueLocations}\n          issuePopup={issuePopup}\n          issues={issues}\n          line={line}\n          onIssueChange={this.props.onIssueChange}\n          onIssuePopupToggle={this.props.onIssuePopupToggle}\n          onIssueSelect={this.props.onIssueSelect}\n          onLocationSelect={this.props.onLocationSelect}\n          onSymbolClick={this.props.onSymbolClick}\n          padding={bottomPadding}\n          scroll={this.props.scroll}\n          secondaryIssueLocations={secondaryIssueLocations}\n          selectedIssue={selectedIssue}\n          showIssues={openIssues || displayAllIssues}\n        />\n      </tr>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport ExpandSnippetIcon from '../../../components/icons/ExpandSnippetIcon';\nimport Line from '../../../components/SourceViewer/components/Line';\nimport { symbolsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport { getSecondaryIssueLocationsForLine } from '../../../components/SourceViewer/helpers/issueLocations';\nimport {\n  optimizeHighlightedSymbols,\n  optimizeLocationMessage,\n  optimizeSelectedIssue\n} from '../../../components/SourceViewer/helpers/lines';\nimport { translate } from '../../../helpers/l10n';\nimport { scrollHorizontally } from '../../../helpers/scrolling';\nimport { BranchLike } from '../../../types/branch-like';\nimport './SnippetViewer.css';\nimport { inSnippet, LINES_BELOW_ISSUE } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  component: T.SourceViewerFile;\n  displayLineNumberOptions?: boolean;\n  displaySCM?: boolean;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  expandBlock: (snippetIndex: number, direction: T.ExpandDirection) => Promise<void>;\n  handleCloseIssues: (line: T.SourceLine) => void;\n  handleOpenIssues: (line: T.SourceLine) => void;\n  handleSymbolClick: (symbols: string[]) => void;\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  highlightedSymbols: string[];\n  index: number;\n  issue: Pick<T.Issue, 'key' | 'textRange' | 'line'>;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  lastSnippetOfLastGroup: boolean;\n  loadDuplications?: (line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLocationSelect: (index: number) => void;\n  openIssuesByLine: T.Dict<boolean>;\n  renderDuplicationPopup: (index: number, line: number) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset?: number) => void;\n  snippet: T.SourceLine[];\n}\n\nexport default class SnippetViewer extends React.PureComponent<Props> {\n  snippetNodeRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: Props) {\n    super(props);\n    this.snippetNodeRef = React.createRef();\n  }\n\n  doScroll = (element: HTMLElement) => {\n    if (this.props.scroll) {\n      this.props.scroll(element);\n    }\n    const parent = this.snippetNodeRef.current as Element;\n\n    if (parent) {\n      const offset = parent.getBoundingClientRect().width / 2;\n\n      scrollHorizontally(element, {\n        leftOffset: offset,\n        rightOffset: offset,\n        parent\n      });\n    }\n  };\n\n  scrollToLastExpandedRow = () => {\n    if (this.props.scroll) {\n      const snippetNode = this.snippetNodeRef.current as Element;\n      if (!snippetNode) {\n        return;\n      }\n      const rows = snippetNode.querySelectorAll('tr');\n      const lastRow = rows[rows.length - 1];\n      this.props.scroll(lastRow, 100);\n    }\n  };\n\n  expandBlock = (direction: T.ExpandDirection) => () =>\n    this.props.expandBlock(this.props.index, direction).then(() => {\n      if (direction === 'down') {\n        this.scrollToLastExpandedRow();\n      }\n    });\n\n  renderLine({\n    displayDuplications,\n    displaySCM,\n    index,\n    issuesForLine,\n    issueLocations,\n    line,\n    snippet,\n    symbols,\n    verticalBuffer\n  }: {\n    displayDuplications: boolean;\n    displaySCM?: boolean;\n    index: number;\n    issuesForLine: T.Issue[];\n    issueLocations: T.LinearIssueLocation[];\n    line: T.SourceLine;\n    snippet: T.SourceLine[];\n    symbols: string[];\n    verticalBuffer: number;\n  }) {\n    const secondaryIssueLocations = getSecondaryIssueLocationsForLine(line, this.props.locations);\n\n    const { displayLineNumberOptions, duplications, duplicationsByLine } = this.props;\n    const duplicationsCount = duplications ? duplications.length : 0;\n    const lineDuplications =\n      (duplicationsCount && duplicationsByLine && duplicationsByLine[line.line]) || [];\n\n    const isSinkLine = issuesForLine.some(i => i.key === this.props.issue.key);\n    const firstLineNumber = snippet && snippet.length ? snippet[0].line : 0;\n    const noop = () => {};\n\n    return (\n      <Line\n        branchLike={this.props.branchLike}\n        displayAllIssues={false}\n        displayCoverage={true}\n        displayDuplications={displayDuplications}\n        displayIssues={!isSinkLine || issuesForLine.length > 1}\n        displayLineNumberOptions={displayLineNumberOptions}\n        displayLocationMarkers={true}\n        displaySCM={displaySCM}\n        duplications={lineDuplications}\n        duplicationsCount={duplicationsCount}\n        firstLineNumber={firstLineNumber}\n        highlighted={false}\n        highlightedLocationMessage={optimizeLocationMessage(\n          this.props.highlightedLocationMessage,\n          secondaryIssueLocations\n        )}\n        highlightedSymbols={optimizeHighlightedSymbols(symbols, this.props.highlightedSymbols)}\n        issueLocations={issueLocations}\n        issuePopup={this.props.issuePopup}\n        issues={issuesForLine}\n        key={line.line}\n        last={false}\n        line={line}\n        loadDuplications={this.props.loadDuplications || noop}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onIssueSelect={noop}\n        onIssueUnselect={noop}\n        onIssuesClose={this.props.handleCloseIssues}\n        onIssuesOpen={this.props.handleOpenIssues}\n        onLocationSelect={this.props.onLocationSelect}\n        onSymbolClick={this.props.handleSymbolClick}\n        openIssues={this.props.openIssuesByLine[line.line]}\n        previousLine={index > 0 ? snippet[index - 1] : undefined}\n        renderDuplicationPopup={this.props.renderDuplicationPopup}\n        scroll={this.doScroll}\n        secondaryIssueLocations={secondaryIssueLocations}\n        selectedIssue={optimizeSelectedIssue(this.props.issue.key, issuesForLine)}\n        verticalBuffer={verticalBuffer}\n      />\n    );\n  }\n\n  render() {\n    const {\n      component,\n      displaySCM,\n      issue,\n      issuesByLine = {},\n      lastSnippetOfLastGroup,\n      locationsByLine,\n      openIssuesByLine,\n      snippet\n    } = this.props;\n    const lastLine =\n      component.measures && component.measures.lines && parseInt(component.measures.lines, 10);\n\n    const symbols = symbolsByLine(snippet);\n\n    const bottomLine = snippet[snippet.length - 1].line;\n    const issueLine = issue.textRange ? issue.textRange.endLine : issue.line;\n    const lowestVisibleIssue = Math.max(\n      ...Object.keys(issuesByLine)\n        .map(k => parseInt(k, 10))\n        .filter(l => inSnippet(l, snippet) && (l === issueLine || openIssuesByLine[l]))\n    );\n    const verticalBuffer = lastSnippetOfLastGroup\n      ? Math.max(0, LINES_BELOW_ISSUE - (bottomLine - lowestVisibleIssue))\n      : 0;\n\n    const displayDuplications =\n      Boolean(this.props.loadDuplications) && snippet.some(s => !!s.duplicated);\n\n    return (\n      <div className=\"source-viewer-code snippet\" ref={this.snippetNodeRef}>\n        <div>\n          {snippet[0].line > 1 && (\n            <div className=\"expand-block expand-block-above\">\n              <button\n                aria-label={translate('source_viewer.expand_above')}\n                onClick={this.expandBlock('up')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n          <table\n            className={classNames('source-table', {\n              'expand-up': snippet[0].line > 1,\n              'expand-down': !lastLine || snippet[snippet.length - 1].line < lastLine\n            })}>\n            <tbody>\n              {snippet.map((line, index) =>\n                this.renderLine({\n                  displayDuplications,\n                  displaySCM,\n                  index,\n                  issuesForLine: issuesByLine[line.line] || [],\n                  issueLocations: locationsByLine[line.line] || [],\n                  line,\n                  snippet,\n                  symbols: symbols[line.line],\n                  verticalBuffer: index === snippet.length - 1 ? verticalBuffer : 0\n                })\n              )}\n            </tbody>\n          </table>\n          {(!lastLine || snippet[snippet.length - 1].line < lastLine) && (\n            <div className=\"expand-block expand-block-below\">\n              <button\n                aria-label={translate('source_viewer.expand_below')}\n                onClick={this.expandBlock('down')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n","var api = require(\"!../../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./SnippetViewer.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".snippet{margin:8px;border:1px solid #cdcdcd;overflow-x:auto;overflow-y:hidden;transition:max-height .2s}.snippet>div{display:table;width:100%;position:relative;transition:margin-top .2s}.snippet table{width:100%}.expand-block{position:absolute;z-index:2;width:100%}.expand-block>button{background:transparent;box-sizing:border-box;color:#666;height:20px;width:100%;padding:2px;border:0;text-align:left;cursor:pointer}.expand-block>button:active,.expand-block>button:focus,.expand-block>button:hover{color:#236a97;outline:none}.expand-block-above{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAAXNSR0IArs4c6QAAADdJREFUCB1dzMEKADAIAlBd1v9/bcc2YgRjHh8qq2qTxCQzsX4wM6y30RARF3sy0Es1SIK7Y64OpCES1W69JS4AAAAASUVORK5CYII=\\\");top:0}.expand-block-below{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wQQBjQEQVd5jwAAADhJREFUCNddyTEKADEMA8GVA/7/Z+PGwUp1cGTaYe/tv5lxrLWoKj6SiMzkjZDEG7JtANt0N+ccLrB/KZxXTt7fAAAAAElFTkSuQmCC\\\");bottom:0}.source-table.expand-up{margin-top:20px}.source-table.expand-down{margin-bottom:20px}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { groupBy, sortBy } from 'lodash';\nimport * as React from 'react';\nimport { Link } from 'react-router';\nimport QualifierIcon from '../../../components/icons/QualifierIcon';\nimport { Alert } from '../../../components/ui/Alert';\nimport { isPullRequest } from '../../../helpers/branch-like';\nimport { translate } from '../../../helpers/l10n';\nimport { collapsedDirFromPath, fileFromPath } from '../../../helpers/path';\nimport { getProjectUrl } from '../../../helpers/urls';\nimport { BranchLike } from '../../../types/branch-like';\nimport { WorkspaceContextShape } from '../../workspace/context';\n\ninterface Props {\n  blocks: T.DuplicationBlock[];\n  branchLike: BranchLike | undefined;\n  duplicatedFiles?: T.Dict<T.DuplicatedFile>;\n  inRemovedComponent: boolean;\n  openComponent: WorkspaceContextShape['openComponent'];\n  sourceViewerFile: T.SourceViewerFile;\n}\n\nexport default class DuplicationPopup extends React.PureComponent<Props> {\n  shouldLink() {\n    const { branchLike } = this.props;\n    return !isPullRequest(branchLike);\n  }\n\n  isDifferentComponent = (\n    a: { project: string; subProject?: string },\n    b: { project: string; subProject?: string }\n  ) => {\n    return Boolean(a && b && (a.project !== b.project || a.subProject !== b.subProject));\n  };\n\n  handleFileClick = (event: React.MouseEvent<HTMLAnchorElement>) => {\n    event.preventDefault();\n    event.currentTarget.blur();\n    const { key, line } = event.currentTarget.dataset;\n    if (this.shouldLink() && key) {\n      this.props.openComponent({\n        branchLike: this.props.branchLike,\n        key,\n        line: line ? Number(line) : undefined\n      });\n    }\n  };\n\n  renderDuplication(file: T.DuplicatedFile, children: React.ReactNode, line?: number) {\n    return this.shouldLink() ? (\n      <a\n        data-key={file.key}\n        data-line={line}\n        href=\"#\"\n        onClick={this.handleFileClick}\n        title={file.name}>\n        {children}\n      </a>\n    ) : (\n      children\n    );\n  }\n\n  render() {\n    const { duplicatedFiles = {}, sourceViewerFile } = this.props;\n\n    const groupedBlocks = groupBy(this.props.blocks, '_ref');\n    let duplications = Object.keys(groupedBlocks).map(fileRef => {\n      return {\n        blocks: groupedBlocks[fileRef],\n        file: duplicatedFiles[fileRef]\n      };\n    });\n\n    // first duplications in the same file\n    // then duplications in the same sub-project\n    // then duplications in the same project\n    // then duplications in other projects\n    duplications = sortBy(\n      duplications,\n      d => d.file.projectName !== sourceViewerFile.projectName,\n      d => d.file.subProjectName !== sourceViewerFile.subProjectName,\n      d => d.file.key !== sourceViewerFile.key\n    );\n\n    return (\n      <div className=\"source-viewer-bubble-popup abs-width-400\">\n        {this.props.inRemovedComponent && (\n          <Alert variant=\"warning\">\n            {translate('duplications.dups_found_on_deleted_resource')}\n          </Alert>\n        )}\n        {duplications.length > 0 && (\n          <>\n            <h6 className=\"spacer-bottom\">\n              {translate('component_viewer.transition.duplication')}\n            </h6>\n            {duplications.map(duplication => (\n              <div className=\"spacer-top text-ellipsis\" key={duplication.file.key}>\n                <div className=\"component-name\">\n                  {this.isDifferentComponent(duplication.file, this.props.sourceViewerFile) && (\n                    <>\n                      <div className=\"component-name-parent\">\n                        <QualifierIcon className=\"little-spacer-right\" qualifier=\"TRK\" />\n                        <Link to={getProjectUrl(duplication.file.project)}>\n                          {duplication.file.projectName}\n                        </Link>\n                      </div>\n                      {duplication.file.subProject && duplication.file.subProjectName && (\n                        <div className=\"component-name-parent\">\n                          <QualifierIcon className=\"little-spacer-right\" qualifier=\"BRC\" />\n                          {duplication.file.subProjectName}\n                        </div>\n                      )}\n                    </>\n                  )}\n\n                  {duplication.file.key !== this.props.sourceViewerFile.key && (\n                    <div className=\"component-name-path\">\n                      {this.renderDuplication(\n                        duplication.file,\n                        <>\n                          <span>{collapsedDirFromPath(duplication.file.name)}</span>\n                          <span className=\"component-name-file\">\n                            {fileFromPath(duplication.file.name)}\n                          </span>\n                        </>\n                      )}\n                    </div>\n                  )}\n\n                  <div className=\"component-name-path\">\n                    {'Lines: '}\n                    {duplication.blocks.map((block, index) => (\n                      <React.Fragment key={index}>\n                        {this.renderDuplication(\n                          duplication.file,\n                          <>\n                            {block.from}\n                            {' – '}\n                            {block.from + block.size - 1}\n                          </>,\n                          block.from\n                        )}\n                        {index < duplication.blocks.length - 1 && ', '}\n                      </React.Fragment>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            ))}\n          </>\n        )}\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\n// TODO Test this function, but I don't get the logic behind it\nexport function filterDuplicationBlocksByLine(blocks: T.DuplicationBlock[], line: number) {\n  /* eslint-disable no-underscore-dangle */\n  let foundOne = false;\n  return blocks.filter(b => {\n    const outOfBounds = b.from > line || b.from + b.size < line;\n    const currentFile = b._ref === '1';\n    const shouldDisplayForCurrentFile = outOfBounds || foundOne;\n    const shouldDisplay = !currentFile || shouldDisplayForCurrentFile;\n    const isOk = b._ref !== undefined && shouldDisplay;\n    if (b._ref === '1' && !outOfBounds) {\n      foundOne = true;\n    }\n    return isOk;\n  });\n  /* eslint-enable no-underscore-dangle */\n}\n\nexport function getDuplicationBlocksForIndex(\n  duplications: T.Duplication[] | undefined,\n  index: number\n) {\n  return (duplications && duplications[index] && duplications[index].blocks) || [];\n}\n\nexport function isDuplicationBlockInRemovedComponent(blocks: T.DuplicationBlock[]) {\n  return blocks.some(b => b._ref === undefined); // eslint-disable-line no-underscore-dangle\n}\n"],"sourceRoot":""}